≤«
_C:\Users\Dzianis_Tarasevich\Desktop\saves\16\WpfOutlook\BLL\BLLService\AdministrationService.cs
	namespace 	
BLL
 
. 
Services 
{ 
public 

class !
AdministrationService &
:' ("
IAdministrationService) ?
{ 
private 
WPFOutlookContext !
_context" *
;* +
private 
IGenericRepository "
<" #
Log# &
>& '
_logs( -
;- .
private 
IGenericRepository "
<" #
User# '
>' (
_users) /
;/ 0
private 
IGenericRepository "
<" #
Group# (
>( )
_groups* 1
;1 2
private 
IGenericRepository "
<" #
Role# '
>' (
_roles) /
;/ 0
public !
AdministrationService $
($ %
IGenericRepository% 7
<7 8
User8 <
>< =
users> C
,C D
IGenericRepositoryE W
<W X
RoleX \
>\ ]
roles^ c
,c d
IGenericRepositorye w
<w x
Groupx }
>} ~
groups	 Ö
,
Ö Ü 
IGenericRepository
á ô
<
ô ö
Log
ö ù
>
ù û
logs
ü £
,
£ §
WPFOutlookContext
• ∂
context
∑ æ
)
æ ø
{ 	
_logs 
= 
logs 
; 
_context 
= 
context 
; 
_users 
= 
users 
; 
_roles 
= 
roles 
; 
_groups 
= 
groups 
; 
}   	
public$$ 
void$$ 
CreateGroup$$ 
($$  
GroupDTO$$  (
groupDTO$$) 1
,$$1 2
ICollection$$3 >
<$$> ?
GroupDTO$$? G
>$$G H
groups$$I O
,$$O P
ICollection$$Q \
<$$\ ]
UserDTO$$] d
>$$d e
users$$f k
,$$k l
int$$m p
id$$q s
)$$s t
{%% 	
var&& 
	groupItem&& 
=&& 
Mapper&& "
.&&" #
Map&&# &
<&&& '
GroupDTO&&' /
,&&/ 0
Group&&1 6
>&&6 7
(&&7 8
groupDTO&&8 @
)&&@ A
;&&A B
	groupItem'' 
.'' 
	CreatorId'' 
=''  !
id''" $
;''$ %
	groupItem(( 
.(( 
Creator(( 
=(( 
_users((  &
.((& '
FindById((' /
(((/ 0
id((0 2
)((2 3
;((3 4
	groupItem** 
.** 
Users** 
=** 
new** !
List**" &
<**& '
User**' +
>**+ ,
(**, -
)**- .
;**. /
var++ 
convertUsers++ 
=++ 
Mapper++ %
.++% &
Map++& )
<++) *
IEnumerable++* 5
<++5 6
UserDTO++6 =
>++= >
,++> ?
IEnumerable++@ K
<++K L
User++L P
>++P Q
>++Q R
(++R S
users++S X
)++X Y
;++Y Z
foreach,, 
(,, 
var,, 
item,, 
in,,  
convertUsers,,! -
),,- .
{-- 
if.. 
(.. 
_users.. 
... 
FindById.. #
(..# $
item..$ (
...( )
UserId..) /
)../ 0
!=..1 3
null..4 8
)..8 9
{// 
	groupItem00 
.00 
Users00 #
.00# $
Add00$ '
(00' (
_users00( .
.00. /
FindById00/ 7
(007 8
item008 <
.00< =
UserId00= C
)00C D
)00D E
;00E F
}11 
}22 
_groups44 
.44 
Create44 
(44 
	groupItem44 $
)44$ %
;44% &
_context55 
.55 
SaveChanges55  
(55  !
)55! "
;55" #
var77 
convertGroups77 
=77 
new77  #
List77$ (
<77( )
Group77) .
>77. /
(77/ 0
)770 1
;771 2
if88 
(88 
groups88 
!=88 
null88 
)88 
{99 
var:: 
convert:: 
=:: 
Mapper:: $
.::$ %
Map::% (
<::( )
IEnumerable::) 4
<::4 5
GroupDTO::5 =
>::= >
,::> ?
IEnumerable::@ K
<::K L
Group::L Q
>::Q R
>::R S
(::S T
groups::T Z
)::Z [
;::[ \
foreach;; 
(;; 
var;; 
item;; !
in;;" $
convert;;% ,
);;, -
{<< 
if== 
(== 
_groups== 
.==  
FindById==  (
(==( )
item==) -
.==- .
GroupId==. 5
)==5 6
!===7 9
null==: >
)==> ?
{>> 
convertGroups?? %
.??% &
Add??& )
(??) *
_groups??* 1
.??1 2
FindById??2 :
(??: ;
item??; ?
.??? @
GroupId??@ G
)??G H
)??H I
;??I J
}@@ 
}AA 
}BB 
foreachDD 
(DD 
varDD 
itemDD 
inDD  
convertGroupsDD! .
)DD. /
{EE 
itemFF 
.FF 
ParentIdFF 
=FF 
	groupItemFF  )
.FF) *
GroupIdFF* 1
;FF1 2
}GG 
_contextII 
.II 
SaveChangesII  
(II  !
)II! "
;II" #
}JJ 	
publicLL 
voidLL 
DeleteGroupLL 
(LL  
intLL  #
idLL$ &
)LL& '
{MM 	
GroupNN 
groupNN 
=NN 
_groupsNN !
.NN! "
FindByIdNN" *
(NN* +
idNN+ -
)NN- .
;NN. /
ICollectionOO 
<OO 
GroupOO 
>OO 
childsOO %
=OO& '
_groupsOO( /
.OO/ 0
GetOO0 3
(OO3 4
gOO4 5
=>OO6 8
gOO9 :
.OO: ;
ParentIdOO; C
==OOD F
groupOOG L
.OOL M
GroupIdOOM T
)OOT U
.OOU V
ToListOOV \
(OO\ ]
)OO] ^
;OO^ _
ifPP 
(PP 
groupPP 
.PP 
ParentIdPP 
!=PP !
nullPP" &
)PP& '
{QQ 
foreachRR 
(RR 
varRR 
itemRR !
inRR" $
childsRR% +
)RR+ ,
{SS 
GroupTT 
childTT 
=TT  !
_groupsTT" )
.TT) *
FindByIdTT* 2
(TT2 3
itemTT3 7
.TT7 8
GroupIdTT8 ?
)TT? @
;TT@ A
childUU 
.UU 
ParentIdUU "
=UU# $
groupUU% *
.UU* +
ParentIdUU+ 3
;UU3 4
}VV 
}WW 
elseXX 
{YY 
foreachZZ 
(ZZ 
varZZ 
itemZZ !
inZZ" $
childsZZ% +
)ZZ+ ,
{[[ 
Group\\ 
child\\ 
=\\  !
_groups\\" )
.\\) *
FindById\\* 2
(\\2 3
item\\3 7
.\\7 8
GroupId\\8 ?
)\\? @
;\\@ A
child]] 
.]] 
ParentId]] "
=]]# $
null]]% )
;]]) *
_groups^^ 
.^^ 
Update^^ "
(^^" #
child^^# (
)^^( )
;^^) *
}__ 
}`` 
_groupsaa 
.aa 
Removeaa 
(aa 
groupaa  
)aa  !
;aa! "
_contextbb 
.bb 
SaveChangesbb  
(bb  !
)bb! "
;bb" #
}cc 	
publicee 
ICollectionee 
<ee 
stringee !
>ee! "
GetGroupAncestorsee# 4
(ee4 5
stringee5 ;
	groupNameee< E
)eeE F
{ff 	
ICollectiongg 
<gg 
stringgg 
>gg 
ancstrorNameListgg  0
=gg1 2
newgg3 6
Listgg7 ;
<gg; <
stringgg< B
>ggB C
(ggC D
)ggD E
;ggE F
Groupii 
groupii 
;ii 
whilejj 
(jj 
	groupNamejj 
!=jj 
nulljj  $
)jj$ %
{kk 
ancstrorNameListll  
.ll  !
Addll! $
(ll$ %
	groupNamell% .
)ll. /
;ll/ 0
groupmm 
=mm 
_groupsmm 
.mm  
Getmm  #
(mm# $
gmm$ %
=>mm& (
gmm) *
.mm* +
	GroupNamemm+ 4
.mm4 5
Equalsmm5 ;
(mm; <
	groupNamemm< E
)mmE F
)mmF G
.mmG H
FirstOrDefaultmmH V
(mmV W
)mmW X
;mmX Y
ifoo 
(oo 
groupoo 
!=oo 
nulloo !
&&oo" $
groupoo% *
.oo* +
ParentIdoo+ 3
!=oo4 6
nulloo7 ;
)oo; <
{pp 
	groupNameqq 
=qq 
_groupsqq  '
.qq' (
Getqq( +
(qq+ ,
gqq, -
=>qq. 0
gqq1 2
.qq2 3
GroupIdqq3 :
==qq; =
groupqq> C
.qqC D
ParentIdqqD L
)qqL M
.qqM N
FirstOrDefaultqqN \
(qq\ ]
)qq] ^
.qq^ _
	GroupNameqq_ h
;qqh i
}rr 
elsess 
{ss 
	groupNamess  
=ss! "
nullss# '
;ss' (
}ss) *
}tt 
returnuu 
ancstrorNameListuu #
;uu# $
}vv 	
publicxx 
ICollectionxx 
<xx 
intxx 
>xx 
GetGroupChildrenxx  0
(xx0 1
intxx1 4
idxx5 7
)xx7 8
{yy 	
SqlParameterzz 
paramzz 
=zz  
newzz! $
SqlParameterzz% 1
(zz1 2
$strzz2 <
,zz< =
idzz> @
)zz@ A
;zzA B
var{{ 
groups{{ 
={{ 
_context{{ !
.{{! "
Database{{" *
.{{* +
SqlQuery{{+ 3
<{{3 4
int{{4 7
>{{7 8
({{8 9
$str{{9 R
,{{R S
param{{T Y
){{Y Z
.{{Z [
ToList{{[ a
({{a b
){{b c
;{{c d
return|| 
groups|| 
.|| 
Distinct|| "
(||" #
)||# $
.||$ %
ToList||% +
(||+ ,
)||, -
;||- .
}}} 	
public 
bool 

CheckGroup 
( 
string %
	groupName& /
)/ 0
{
ÄÄ 	
if
ÅÅ 
(
ÅÅ 
_groups
ÅÅ 
.
ÅÅ 
Get
ÅÅ 
(
ÅÅ 
g
ÅÅ 
=>
ÅÅ  
g
ÅÅ! "
.
ÅÅ" #
	GroupName
ÅÅ# ,
.
ÅÅ, -
ToLower
ÅÅ- 4
(
ÅÅ4 5
)
ÅÅ5 6
.
ÅÅ6 7
Equals
ÅÅ7 =
(
ÅÅ= >
	groupName
ÅÅ> G
.
ÅÅG H
ToLower
ÅÅH O
(
ÅÅO P
)
ÅÅP Q
)
ÅÅQ R
)
ÅÅR S
.
ÅÅS T
Any
ÅÅT W
(
ÅÅW X
)
ÅÅX Y
)
ÅÅY Z
return
ÇÇ 
false
ÇÇ 
;
ÇÇ 
else
ÉÉ 
return
ÉÉ 
true
ÉÉ 
;
ÉÉ 
}
ÑÑ 	
public
ÜÜ 
ICollection
ÜÜ 
<
ÜÜ 
GroupDTO
ÜÜ #
>
ÜÜ# $%
GetGroupFirstGeneration
ÜÜ% <
(
ÜÜ< =
int
ÜÜ= @
id
ÜÜA C
)
ÜÜC D
{
áá 	
return
àà 
Mapper
àà 
.
àà 
Map
àà 
<
àà 
IEnumerable
àà )
<
àà) *
Group
àà* /
>
àà/ 0
,
àà0 1
ICollection
àà2 =
<
àà= >
GroupDTO
àà> F
>
ààF G
>
ààG H
(
ààH I
_groups
ààI P
.
ààP Q
Get
ààQ T
(
ààT U
g
ààU V
=>
ààW Y
g
ààZ [
.
àà[ \
ParentId
àà\ d
==
ààe g
id
ààh j
)
ààj k
)
ààk l
;
ààl m
}
ââ 	
private
ãã 
void
ãã #
DeleteUsersFromBranch
ãã *
(
ãã* +
ICollection
ãã+ 6
<
ãã6 7
User
ãã7 ;
>
ãã; <
users
ãã= B
,
ããB C
int
ããD G
id
ããH J
)
ããJ K
{
åå 	
SqlParameter
çç 
param1
çç 
=
çç  !
new
çç" %
SqlParameter
çç& 2
(
çç2 3
$str
çç3 =
,
çç= >
id
çç? A
)
ççA B
;
ççB C
var
éé 
	dataTable
éé 
=
éé 
new
éé 
	DataTable
éé  )
(
éé) *
)
éé* +
;
éé+ ,
	dataTable
èè 
.
èè 
Columns
èè 
.
èè 
Add
èè !
(
èè! "
$str
èè" *
,
èè* +
typeof
èè, 2
(
èè2 3
int
èè3 6
)
èè6 7
)
èè7 8
;
èè8 9
foreach
êê 
(
êê 
var
êê 
item
êê 
in
êê  
users
êê! &
.
êê& '
Select
êê' -
(
êê- .
u
êê. /
=>
êê0 2
u
êê3 4
.
êê4 5
UserId
êê5 ;
)
êê; <
)
êê< =
{
ëë 
	dataTable
íí 
.
íí 
Rows
íí 
.
íí 
Add
íí "
(
íí" #
item
íí# '
)
íí' (
;
íí( )
}
ìì 
SqlParameter
îî 
param2
îî 
=
îî  !
new
îî" %
SqlParameter
îî& 2
(
îî2 3
$str
îî3 :
,
îî: ;
	SqlDbType
îî< E
.
îîE F

Structured
îîF P
)
îîP Q
;
îîQ R
param2
ïï 
.
ïï 
Value
ïï 
=
ïï 
	dataTable
ïï $
;
ïï$ %
param2
ññ 
.
ññ 
TypeName
ññ 
=
ññ 
$str
ññ ,
;
ññ, -
var
óó 
res
óó 
=
óó 
_context
óó 
.
óó 
Database
óó '
.
óó' (
ExecuteSqlCommand
óó( 9
(
óó9 :
$str
óó: e
,
óóe f
param1
óóg m
,
óóm n
param2
óóo u
)
óóu v
;
óóv w
}
òò 	
private
öö 
ICollection
öö 
<
öö 
User
öö  
>
öö  !'
GetGroupUsersFromBranches
öö" ;
(
öö; <
int
öö< ?
id
öö@ B
)
ööB C
{
õõ 	
List
úú 
<
úú 
User
úú 
>
úú 
users
úú 
=
úú 
new
úú "
List
úú# '
<
úú' (
User
úú( ,
>
úú, -
(
úú- .
)
úú. /
;
úú/ 0
foreach
ùù 
(
ùù 
var
ùù 
item
ùù 
in
ùù  
GetGroupChildren
ùù! 1
(
ùù1 2
id
ùù2 4
)
ùù4 5
)
ùù5 6
{
ûû 
users
üü 
.
üü 
AddRange
üü 
(
üü 
_groups
üü &
.
üü& '
FindById
üü' /
(
üü/ 0
item
üü0 4
)
üü4 5
.
üü5 6
Users
üü6 ;
)
üü; <
;
üü< =
}
†† 
users
°° 
.
°° 
AddRange
°° 
(
°° 
_groups
°° "
.
°°" #
FindById
°°# +
(
°°+ ,
id
°°, .
)
°°. /
.
°°/ 0
Users
°°0 5
)
°°5 6
;
°°6 7
return
¢¢ 
users
¢¢ 
.
¢¢ 
GroupBy
¢¢  
(
¢¢  !
u
¢¢! "
=>
¢¢# %
u
¢¢& '
.
¢¢' (
UserId
¢¢( .
)
¢¢. /
.
¢¢/ 0
Select
¢¢0 6
(
¢¢6 7
g
¢¢7 8
=>
¢¢9 ;
g
¢¢< =
.
¢¢= >
First
¢¢> C
(
¢¢C D
)
¢¢D E
)
¢¢E F
.
¢¢F G
ToList
¢¢G M
(
¢¢M N
)
¢¢N O
;
¢¢O P
}
££ 	
public
•• 
void
•• 
	EditGroup
•• 
(
•• 
GroupDTO
•• &
group
••' ,
,
••, -
ICollection
••. 9
<
••9 :
GroupDTO
••: B
>
••B C
selectedGroups
••D R
,
••R S
ICollection
••T _
<
••_ `
UserDTO
••` g
>
••g h
selectedUsers
••i v
)
••v w
{
¶¶ 	
if
ßß 
(
ßß 
group
ßß 
.
ßß 
	GroupName
ßß 
!=
ßß  "
null
ßß# '
)
ßß' (
{
®® 
Group
©© 
groupToEdit
©© !
=
©©" #
_groups
©©$ +
.
©©+ ,
FindById
©©, 4
(
©©4 5
group
©©5 :
.
©©: ;
GroupId
©©; B
)
©©B C
;
©©C D
if
™™ 
(
™™ 
group
™™ 
.
™™ 
	GroupName
™™ #
!=
™™$ &
null
™™' +
&&
™™, .
group
™™/ 4
.
™™4 5
	GroupName
™™5 >
!=
™™? A
groupToEdit
™™B M
.
™™M N
	GroupName
™™N W
)
™™W X
groupToEdit
™™Y d
.
™™d e
	GroupName
™™e n
=
™™o p
group
™™q v
.
™™v w
	GroupName™™w Ä
;™™Ä Å
if
´´ 
(
´´ 
group
´´ 
.
´´ 
ParentId
´´ "
!=
´´# %
groupToEdit
´´& 1
.
´´1 2
ParentId
´´2 :
)
´´: ;
groupToEdit
´´< G
.
´´G H
ParentId
´´H P
=
´´Q R
group
´´S X
.
´´X Y
ParentId
´´Y a
;
´´a b
ICollection
¨¨ 
<
¨¨ 
User
¨¨  
>
¨¨  !
usersFromBranches
¨¨" 3
=
¨¨4 5'
GetGroupUsersFromBranches
¨¨6 O
(
¨¨O P
groupToEdit
¨¨P [
.
¨¨[ \
GroupId
¨¨\ c
)
¨¨c d
;
¨¨d e
if
≠≠ 
(
≠≠ 
selectedUsers
≠≠ !
.
≠≠! "
Any
≠≠" %
(
≠≠% &
)
≠≠& '
)
≠≠' (
{
ÆÆ 
var
ØØ 
convertUsers
ØØ $
=
ØØ% &
new
ØØ' *
List
ØØ+ /
<
ØØ/ 0
User
ØØ0 4
>
ØØ4 5
(
ØØ5 6
)
ØØ6 7
;
ØØ7 8
if
∞∞ 
(
∞∞ 
selectedUsers
∞∞ %
!=
∞∞& (
null
∞∞) -
)
∞∞- .
{
±± 
var
≤≤ 
convert
≤≤ #
=
≤≤$ %
Mapper
≤≤& ,
.
≤≤, -
Map
≤≤- 0
<
≤≤0 1
IEnumerable
≤≤1 <
<
≤≤< =
UserDTO
≤≤= D
>
≤≤D E
,
≤≤E F
ICollection
≤≤G R
<
≤≤R S
User
≤≤S W
>
≤≤W X
>
≤≤X Y
(
≤≤Y Z
selectedUsers
≤≤Z g
)
≤≤g h
;
≤≤h i
foreach
≥≥ 
(
≥≥  !
var
≥≥! $
item
≥≥% )
in
≥≥* ,
convert
≥≥- 4
)
≥≥4 5
{
¥¥ 
if
µµ 
(
µµ  
_users
µµ  &
.
µµ& '
FindById
µµ' /
(
µµ/ 0
item
µµ0 4
.
µµ4 5
UserId
µµ5 ;
)
µµ; <
!=
µµ= ?
null
µµ@ D
)
µµD E
{
∂∂ 
convertUsers
∑∑  ,
.
∑∑, -
Add
∑∑- 0
(
∑∑0 1
_users
∑∑1 7
.
∑∑7 8
FindById
∑∑8 @
(
∑∑@ A
item
∑∑A E
.
∑∑E F
UserId
∑∑F L
)
∑∑L M
)
∑∑M N
;
∑∑N O
}
∏∏ 
}
ππ 
}
∫∫ 
groupToEdit
ºº 
.
ºº  
Users
ºº  %
=
ºº& '
groupToEdit
ºº( 3
.
ºº3 4
Users
ºº4 9
.
ºº9 :
	Intersect
ºº: C
(
ººC D
convertUsers
ººD P
)
ººP Q
.
ººQ R
ToList
ººR X
(
ººX Y
)
ººY Z
;
ººZ [
foreach
ΩΩ 
(
ΩΩ 
var
ΩΩ  
oldUser
ΩΩ! (
in
ΩΩ) +
usersFromBranches
ΩΩ, =
.
ΩΩ= >
ToList
ΩΩ> D
(
ΩΩD E
)
ΩΩE F
)
ΩΩF G
{
ææ 
foreach
øø 
(
øø  !
var
øø! $
user
øø% )
in
øø* ,
selectedUsers
øø- :
.
øø: ;
ToList
øø; A
(
øøA B
)
øøB C
)
øøC D
{
¿¿ 
if
¡¡ 
(
¡¡  
user
¡¡  $
.
¡¡$ %
UserId
¡¡% +
==
¡¡, .
oldUser
¡¡/ 6
.
¡¡6 7
UserId
¡¡7 =
)
¡¡= >
{
¬¬ 
usersFromBranches
√√  1
.
√√1 2
Remove
√√2 8
(
√√8 9
oldUser
√√9 @
)
√√@ A
;
√√A B
selectedUsers
ƒƒ  -
.
ƒƒ- .
Remove
ƒƒ. 4
(
ƒƒ4 5
user
ƒƒ5 9
)
ƒƒ9 :
;
ƒƒ: ;
}
≈≈ 
}
∆∆ 
}
«« 
if
»» 
(
»» 
usersFromBranches
»» )
.
»») *
Any
»»* -
(
»»- .
)
»». /
)
»»/ 0
{
…… #
DeleteUsersFromBranch
   -
(
  - .
usersFromBranches
  . ?
,
  ? @
groupToEdit
  A L
.
  L M
GroupId
  M T
)
  T U
;
  U V
}
ÀÀ 
if
ÃÃ 
(
ÃÃ 
selectedUsers
ÃÃ %
.
ÃÃ% &
Any
ÃÃ& )
(
ÃÃ) *
)
ÃÃ* +
)
ÃÃ+ ,
{
ÕÕ 
foreach
ŒŒ 
(
ŒŒ  !
var
ŒŒ! $
item
ŒŒ% )
in
ŒŒ* ,
selectedUsers
ŒŒ- :
.
ŒŒ: ;
ToList
ŒŒ; A
(
ŒŒA B
)
ŒŒB C
)
ŒŒC D
{
œœ 
groupToEdit
–– '
.
––' (
Users
––( -
.
––- .
Add
––. 1
(
––1 2
_users
––2 8
.
––8 9
FindById
––9 A
(
––A B
item
––B F
.
––F G
UserId
––G M
)
––M N
)
––N O
;
––O P
}
—— 
}
““ 
}
”” 
else
‘‘ 
{
’’ 
foreach
÷÷ 
(
÷÷ 
var
÷÷  
item
÷÷! %
in
÷÷& (
groupToEdit
÷÷) 4
.
÷÷4 5
Users
÷÷5 :
.
÷÷: ;
ToList
÷÷; A
(
÷÷A B
)
÷÷B C
)
÷÷C D
{
◊◊ 
groupToEdit
ÿÿ #
.
ÿÿ# $
Users
ÿÿ$ )
.
ÿÿ) *
Remove
ÿÿ* 0
(
ÿÿ0 1
_users
ÿÿ1 7
.
ÿÿ7 8
FindById
ÿÿ8 @
(
ÿÿ@ A
item
ÿÿA E
.
ÿÿE F
UserId
ÿÿF L
)
ÿÿL M
)
ÿÿM N
;
ÿÿN O
}
ŸŸ 
if
⁄⁄ 
(
⁄⁄ 
usersFromBranches
⁄⁄ )
.
⁄⁄) *
Any
⁄⁄* -
(
⁄⁄- .
)
⁄⁄. /
)
⁄⁄/ 0#
DeleteUsersFromBranch
€€ -
(
€€- .
usersFromBranches
€€. ?
,
€€? @
groupToEdit
€€A L
.
€€L M
GroupId
€€M T
)
€€T U
;
€€U V
}
‹‹ 
ICollection
›› 
<
›› 
Group
›› !
>
››! "
	oldGroups
››# ,
=
››- .
_groups
››/ 6
.
››6 7
Get
››7 :
(
››: ;
g
››; <
=>
››= ?
g
››@ A
.
››A B
ParentId
››B J
==
››K M
groupToEdit
››N Y
.
››Y Z
GroupId
››Z a
)
››a b
.
››b c
ToList
››c i
(
››i j
)
››j k
;
››k l
foreach
ﬁﬁ 
(
ﬁﬁ 
var
ﬁﬁ 
item
ﬁﬁ !
in
ﬁﬁ" $
	oldGroups
ﬁﬁ% .
.
ﬁﬁ. /
ToList
ﬁﬁ/ 5
(
ﬁﬁ5 6
)
ﬁﬁ6 7
)
ﬁﬁ7 8
{
ﬂﬂ 
foreach
‡‡ 
(
‡‡ 
var
‡‡  
temp
‡‡! %
in
‡‡& (
selectedGroups
‡‡) 7
.
‡‡7 8
ToList
‡‡8 >
(
‡‡> ?
)
‡‡? @
)
‡‡@ A
{
·· 
if
‚‚ 
(
‚‚ 
item
‚‚  
.
‚‚  !
GroupId
‚‚! (
==
‚‚) +
temp
‚‚, 0
.
‚‚0 1
GroupId
‚‚1 8
)
‚‚8 9
{
„„ 
	oldGroups
‰‰ %
.
‰‰% &
Remove
‰‰& ,
(
‰‰, -
item
‰‰- 1
)
‰‰1 2
;
‰‰2 3
selectedGroups
ÂÂ *
.
ÂÂ* +
Remove
ÂÂ+ 1
(
ÂÂ1 2
temp
ÂÂ2 6
)
ÂÂ6 7
;
ÂÂ7 8
}
ÊÊ 
}
ÁÁ 
}
ËË 
if
ÈÈ 
(
ÈÈ 
	oldGroups
ÈÈ 
.
ÈÈ 
Any
ÈÈ !
(
ÈÈ! "
)
ÈÈ" #
)
ÈÈ# $
{
ÍÍ 
foreach
ÎÎ 
(
ÎÎ 
var
ÎÎ  
item
ÎÎ! %
in
ÎÎ& (
	oldGroups
ÎÎ) 2
)
ÎÎ2 3
{
ÏÏ 
var
ÌÌ 
temp
ÌÌ  
=
ÌÌ! "
_groups
ÌÌ# *
.
ÌÌ* +
FindById
ÌÌ+ 3
(
ÌÌ3 4
item
ÌÌ4 8
.
ÌÌ8 9
GroupId
ÌÌ9 @
)
ÌÌ@ A
;
ÌÌA B
temp
ÓÓ 
.
ÓÓ 
ParentId
ÓÓ %
=
ÓÓ& '
null
ÓÓ( ,
;
ÓÓ, -
}
ÔÔ 
}
 
if
ÒÒ 
(
ÒÒ 
selectedGroups
ÒÒ "
.
ÒÒ" #
Any
ÒÒ# &
(
ÒÒ& '
)
ÒÒ' (
)
ÒÒ( )
{
ÚÚ 
var
ÛÛ 
convertGroups
ÛÛ %
=
ÛÛ& '
new
ÛÛ( +
List
ÛÛ, 0
<
ÛÛ0 1
Group
ÛÛ1 6
>
ÛÛ6 7
(
ÛÛ7 8
)
ÛÛ8 9
;
ÛÛ9 :
if
ÙÙ 
(
ÙÙ 
selectedGroups
ÙÙ &
!=
ÙÙ' )
null
ÙÙ* .
)
ÙÙ. /
{
ıı 
var
ˆˆ 
convert
ˆˆ #
=
ˆˆ$ %
Mapper
ˆˆ& ,
.
ˆˆ, -
Map
ˆˆ- 0
<
ˆˆ0 1
IEnumerable
ˆˆ1 <
<
ˆˆ< =
GroupDTO
ˆˆ= E
>
ˆˆE F
,
ˆˆF G
IEnumerable
ˆˆH S
<
ˆˆS T
Group
ˆˆT Y
>
ˆˆY Z
>
ˆˆZ [
(
ˆˆ[ \
selectedGroups
ˆˆ\ j
)
ˆˆj k
;
ˆˆk l
foreach
˜˜ 
(
˜˜  !
var
˜˜! $
item
˜˜% )
in
˜˜* ,
convert
˜˜- 4
)
˜˜4 5
{
¯¯ 
if
˘˘ 
(
˘˘  
_groups
˘˘  '
.
˘˘' (
FindById
˘˘( 0
(
˘˘0 1
item
˘˘1 5
.
˘˘5 6
GroupId
˘˘6 =
)
˘˘= >
!=
˘˘? A
null
˘˘B F
)
˘˘F G
{
˙˙ 
convertGroups
˚˚  -
.
˚˚- .
Add
˚˚. 1
(
˚˚1 2
_groups
˚˚2 9
.
˚˚9 :
FindById
˚˚: B
(
˚˚B C
item
˚˚C G
.
˚˚G H
GroupId
˚˚H O
)
˚˚O P
)
˚˚P Q
;
˚˚Q R
}
¸¸ 
}
˝˝ 
}
˛˛ 
foreach
ÄÄ 
(
ÄÄ 
var
ÄÄ  
item
ÄÄ! %
in
ÄÄ& (
convertGroups
ÄÄ) 6
)
ÄÄ6 7
{
ÅÅ 
item
ÇÇ 
.
ÇÇ 
ParentId
ÇÇ %
=
ÇÇ& '
groupToEdit
ÇÇ( 3
.
ÇÇ3 4
GroupId
ÇÇ4 ;
;
ÇÇ; <
}
ÉÉ 
}
ÑÑ 
_context
ÖÖ 
.
ÖÖ 
SaveChanges
ÖÖ $
(
ÖÖ$ %
)
ÖÖ% &
;
ÖÖ& '
foreach
ÜÜ 
(
ÜÜ 
var
ÜÜ 
id
ÜÜ 
in
ÜÜ  "
usersFromBranches
ÜÜ# 4
.
ÜÜ4 5
Select
ÜÜ5 ;
(
ÜÜ; <
u
ÜÜ< =
=>
ÜÜ> @
u
ÜÜA B
.
ÜÜB C
UserId
ÜÜC I
)
ÜÜI J
)
ÜÜJ K
{
áá 
_context
àà 
.
àà 
Entry
àà "
(
àà" #
_users
àà# )
.
àà) *
FindById
àà* 2
(
àà2 3
id
àà3 5
)
àà5 6
)
àà6 7
.
àà7 8
State
àà8 =
=
àà> ?
System
àà@ F
.
ààF G
Data
ààG K
.
ààK L
Entity
ààL R
.
ààR S
EntityState
ààS ^
.
àà^ _
Detached
àà_ g
;
ààg h
}
ââ 
}
ää 
}
ãã 	
public
çç 
ICollection
çç 
<
çç 
GroupDTO
çç #
>
çç# $&
GetGroupsWithNoAncestors
çç% =
(
çç= >
)
çç> ?
{
éé 	
List
èè 
<
èè 
Group
èè 
>
èè 

collection
èè "
;
èè" #
using
êê 
(
êê 
_logs
êê 
.
êê 
BeginTransaction
êê )
(
êê) *
)
êê* +
)
êê+ ,
{
ëë 

collection
íí 
=
íí 
_groups
íí $
.
íí$ %
Get
íí% (
(
íí( )
g
íí) *
=>
íí+ -
g
íí. /
.
íí/ 0
ParentId
íí0 8
==
íí9 ;
null
íí< @
)
íí@ A
.
ííA B
ToList
ííB H
(
ííH I
)
ííI J
;
ííJ K
}
ìì 
var
îî 
mappingCollection
îî !
=
îî" #
Mapper
îî$ *
.
îî* +
Map
îî+ .
<
îî. /
IEnumerable
îî/ :
<
îî: ;
Group
îî; @
>
îî@ A
,
îîA B
ICollection
îîC N
<
îîN O
GroupDTO
îîO W
>
îîW X
>
îîX Y
(
îîY Z

collection
îîZ d
)
îîd e
.
îîe f
ToList
îîf l
(
îîl m
)
îîm n
;
îîn o
foreach
ïï 
(
ïï 
var
ïï 
item
ïï 
in
ïï  
mappingCollection
ïï! 2
)
ïï2 3
{
ññ 
item
óó 
.
óó 
CreatorName
óó  
=
óó! "
GetUserById
óó# .
(
óó. /
item
óó/ 3
.
óó3 4
	CreatorId
óó4 =
)
óó= >
.
óó> ?
Name
óó? C
;
óóC D
item
òò 
.
òò 

ParentName
òò 
=
òò  !
GetGroupName
òò" .
(
òò. /
item
òò/ 3
.
òò3 4
ParentId
òò4 <
)
òò< =
;
òò= >
item
ôô 
.
ôô 
Groups
ôô 
=
ôô %
GetGroupFirstGeneration
ôô 5
(
ôô5 6
item
ôô6 :
.
ôô: ;
GroupId
ôô; B
)
ôôB C
;
ôôC D
item
öö 
.
öö 
Users
öö 
=
öö 
new
öö  "
ObservableCollection
öö! 5
<
öö5 6
UserDTO
öö6 =
>
öö= >
(
öö> ?
GetGroupUsers
öö? L
(
ööL M
item
ööM Q
.
ööQ R
GroupId
ööR Y
)
ööY Z
)
ööZ [
;
öö[ \
}
õõ 
return
úú 
mappingCollection
úú $
;
úú$ %
}
ùù 	
public
üü 
ICollection
üü 
<
üü 
UserDTO
üü "
>
üü" #
GetGroupUsers
üü$ 1
(
üü1 2
int
üü2 5
id
üü6 8
)
üü8 9
{
†† 	
ICollection
°° 
<
°° 
UserDTO
°° 
>
°°  
users
°°! &
=
°°' (
Mapper
°°) /
.
°°/ 0
Map
°°0 3
<
°°3 4
IEnumerable
°°4 ?
<
°°? @
User
°°@ D
>
°°D E
,
°°E F
ICollection
°°G R
<
°°R S
UserDTO
°°S Z
>
°°Z [
>
°°[ \
(
°°\ ]'
GetGroupUsersFromBranches
°°] v
(
°°v w
id
°°w y
)
°°y z
)
°°z {
;
°°{ |
return
¢¢ 
users
¢¢ 
;
¢¢ 
}
££ 	
public
•• 
GroupDTO
•• 
GetGroupById
•• $
(
••$ %
int
••% (
?
••( )
id
••* ,
)
••, -
{
¶¶ 	
if
ßß 
(
ßß 
id
ßß 
!=
ßß 
null
ßß 
)
ßß 
{
®® 
return
©© 
null
©© 
;
©© 
}
™™ 
else
´´ 
return
´´ 
Mapper
´´ 
.
´´ 
Map
´´ "
<
´´" #
Group
´´# (
,
´´( )
GroupDTO
´´* 2
>
´´2 3
(
´´3 4
_groups
´´4 ;
.
´´; <
FindById
´´< D
(
´´D E
(
´´E F
int
´´F I
)
´´I J
id
´´J L
)
´´L M
)
´´M N
;
´´N O
}
¨¨ 	
public
ÆÆ 
string
ÆÆ 
GetGroupName
ÆÆ "
(
ÆÆ" #
int
ÆÆ# &
?
ÆÆ& '
id
ÆÆ( *
)
ÆÆ* +
{
ØØ 	
if
∞∞ 
(
∞∞ 
id
∞∞ 
==
∞∞ 
null
∞∞ 
)
∞∞ 
{
±± 
return
≤≤ 
string
≤≤ 
.
≤≤ 
Empty
≤≤ #
;
≤≤# $
}
≥≥ 
else
¥¥ 
return
¥¥ 
_groups
¥¥ 
.
¥¥  
FindById
¥¥  (
(
¥¥( )
(
¥¥) *
int
¥¥* -
)
¥¥- .
id
¥¥. 0
)
¥¥0 1
.
¥¥1 2
	GroupName
¥¥2 ;
;
¥¥; <
}
∂∂ 	
public
ºº 
void
ºº 

CreateUser
ºº 
(
ºº 
UserDTO
ºº &
user
ºº' +
,
ºº+ ,
ICollection
ºº- 8
<
ºº8 9
GroupDTO
ºº9 A
>
ººA B
groups
ººC I
,
ººI J
ICollection
ººK V
<
ººV W
RoleDTO
ººW ^
>
ºº^ _
roles
ºº` e
)
ººe f
{
ΩΩ 	
var
ææ 
salt
ææ 
=
ææ 
EncryptionHelpers
ææ (
.
ææ( )
GenerateSalt
ææ) 5
(
ææ5 6
)
ææ6 7
;
ææ7 8
var
¿¿ 
userItem
¿¿ 
=
¿¿ 
Mapper
¿¿ !
.
¿¿! "
Map
¿¿" %
<
¿¿% &
UserDTO
¿¿& -
,
¿¿- .
User
¿¿/ 3
>
¿¿3 4
(
¿¿4 5
user
¿¿5 9
)
¿¿9 :
;
¿¿: ;
userItem
¡¡ 
.
¡¡ 
Salt
¡¡ 
=
¡¡ 
salt
¡¡  
;
¡¡  !
userItem
¬¬ 
.
¬¬ 
Password
¬¬ 
=
¬¬ 
EncryptionHelpers
¬¬  1
.
¬¬1 2
HashPassword
¬¬2 >
(
¬¬> ?
user
¬¬? C
.
¬¬C D
Password
¬¬D L
,
¬¬L M
salt
¬¬N R
)
¬¬R S
;
¬¬S T
userItem
ƒƒ 
.
ƒƒ 
Roles
ƒƒ 
=
ƒƒ 
new
ƒƒ  
List
ƒƒ! %
<
ƒƒ% &
Role
ƒƒ& *
>
ƒƒ* +
(
ƒƒ+ ,
)
ƒƒ, -
;
ƒƒ- .
var
≈≈ 
convertRoles
≈≈ 
=
≈≈ 
Mapper
≈≈ %
.
≈≈% &
Map
≈≈& )
<
≈≈) *
IEnumerable
≈≈* 5
<
≈≈5 6
RoleDTO
≈≈6 =
>
≈≈= >
,
≈≈> ?
IEnumerable
≈≈@ K
<
≈≈K L
Role
≈≈L P
>
≈≈P Q
>
≈≈Q R
(
≈≈R S
roles
≈≈S X
)
≈≈X Y
;
≈≈Y Z
foreach
∆∆ 
(
∆∆ 
var
∆∆ 
item
∆∆ 
in
∆∆  
convertRoles
∆∆! -
)
∆∆- .
{
«« 
if
»» 
(
»» 
_roles
»» 
.
»» 
FindById
»» #
(
»»# $
item
»»$ (
.
»»( )
RoleId
»») /
)
»»/ 0
!=
»»1 3
null
»»4 8
)
»»8 9
{
…… 
userItem
   
.
   
Roles
   "
.
  " #
Add
  # &
(
  & '
_roles
  ' -
.
  - .
FindById
  . 6
(
  6 7
item
  7 ;
.
  ; <
RoleId
  < B
)
  B C
)
  C D
;
  D E
}
ÀÀ 
}
ÃÃ 
userItem
ŒŒ 
.
ŒŒ 
Groups
ŒŒ 
=
ŒŒ 
new
ŒŒ !
List
ŒŒ" &
<
ŒŒ& '
Group
ŒŒ' ,
>
ŒŒ, -
(
ŒŒ- .
)
ŒŒ. /
;
ŒŒ/ 0
var
œœ 
convertGroups
œœ 
=
œœ 
Mapper
œœ  &
.
œœ& '
Map
œœ' *
<
œœ* +
IEnumerable
œœ+ 6
<
œœ6 7
GroupDTO
œœ7 ?
>
œœ? @
,
œœ@ A
IEnumerable
œœB M
<
œœM N
Group
œœN S
>
œœS T
>
œœT U
(
œœU V
groups
œœV \
)
œœ\ ]
;
œœ] ^
foreach
–– 
(
–– 
var
–– 
item
–– 
in
––  
convertGroups
––! .
)
––. /
{
—— 
if
““ 
(
““ 
_groups
““ 
.
““ 
FindById
““ $
(
““$ %
item
““% )
.
““) *
GroupId
““* 1
)
““1 2
!=
““3 5
null
““6 :
)
““: ;
{
”” 
userItem
‘‘ 
.
‘‘ 
Groups
‘‘ #
.
‘‘# $
Add
‘‘$ '
(
‘‘' (
_groups
‘‘( /
.
‘‘/ 0
FindById
‘‘0 8
(
‘‘8 9
item
‘‘9 =
.
‘‘= >
GroupId
‘‘> E
)
‘‘E F
)
‘‘F G
;
‘‘G H
}
’’ 
}
÷÷ 
_users
ÿÿ 
.
ÿÿ 
Create
ÿÿ 
(
ÿÿ 
userItem
ÿÿ "
)
ÿÿ" #
;
ÿÿ# $
_context
ŸŸ 
.
ŸŸ 
SaveChanges
ŸŸ  
(
ŸŸ  !
)
ŸŸ! "
;
ŸŸ" #
}
⁄⁄ 	
public
‹‹ 
void
‹‹ 
EditUser
‹‹ 
(
‹‹ 
UserDTO
‹‹ $
user
‹‹% )
,
‹‹) *
ICollection
‹‹+ 6
<
‹‹6 7
GroupDTO
‹‹7 ?
>
‹‹? @
groups
‹‹A G
,
‹‹G H
ICollection
‹‹I T
<
‹‹T U
RoleDTO
‹‹U \
>
‹‹\ ]
roles
‹‹^ c
)
‹‹c d
{
›› 	
if
ﬁﬁ 
(
ﬁﬁ 
user
ﬁﬁ 
.
ﬁﬁ 
UserName
ﬁﬁ 
!=
ﬁﬁ  
null
ﬁﬁ! %
&&
ﬁﬁ& (
user
ﬁﬁ) -
.
ﬁﬁ- .
Password
ﬁﬁ. 6
!=
ﬁﬁ7 9
null
ﬁﬁ: >
)
ﬁﬁ> ?
{
ﬂﬂ 
User
‡‡ 

userToEdit
‡‡ 
=
‡‡  !
_users
‡‡" (
.
‡‡( )
FindById
‡‡) 1
(
‡‡1 2
user
‡‡2 6
.
‡‡6 7
UserId
‡‡7 =
)
‡‡= >
;
‡‡> ?
if
·· 
(
·· 
user
·· 
.
·· 
Name
·· 
!=
··  
null
··! %
)
··% &

userToEdit
··' 1
.
··1 2
Name
··2 6
=
··7 8
user
··9 =
.
··= >
Name
··> B
;
··B C
if
‚‚ 
(
‚‚ 
(
‚‚ 
user
‚‚ 
.
‚‚ 
UserName
‚‚ "
!=
‚‚# %
null
‚‚& *
||
‚‚+ -

userToEdit
‚‚. 8
.
‚‚8 9
UserName
‚‚9 A
==
‚‚B D
user
‚‚E I
.
‚‚I J
UserName
‚‚J R
)
‚‚R S
&&
‚‚T V
	CheckUser
‚‚W `
(
‚‚` a
user
‚‚a e
.
‚‚e f
UserName
‚‚f n
)
‚‚n o
)
‚‚o p

userToEdit
‚‚q {
.
‚‚{ |
UserName‚‚| Ñ
=‚‚Ö Ü
user‚‚á ã
.‚‚ã å
UserName‚‚å î
;‚‚î ï
if
„„ 
(
„„ 
user
„„ 
.
„„ 
Password
„„ !
!=
„„" $
null
„„% )
&&
„„* ,
user
„„- 1
.
„„1 2
Password
„„2 :
!=
„„; =

userToEdit
„„> H
.
„„H I
Password
„„I Q
)
„„Q R
{
‰‰ 
var
ÂÂ 
salt
ÂÂ 
=
ÂÂ 
EncryptionHelpers
ÂÂ 0
.
ÂÂ0 1
GenerateSalt
ÂÂ1 =
(
ÂÂ= >
)
ÂÂ> ?
;
ÂÂ? @

userToEdit
ÊÊ 
.
ÊÊ 
Salt
ÊÊ #
=
ÊÊ$ %
salt
ÊÊ& *
;
ÊÊ* +

userToEdit
ÁÁ 
.
ÁÁ 
Password
ÁÁ '
=
ÁÁ( )
EncryptionHelpers
ÁÁ* ;
.
ÁÁ; <
HashPassword
ÁÁ< H
(
ÁÁH I
user
ÁÁI M
.
ÁÁM N
Password
ÁÁN V
,
ÁÁV W
salt
ÁÁX \
)
ÁÁ\ ]
;
ÁÁ] ^
}
ËË 
if
ÈÈ 
(
ÈÈ 
user
ÈÈ 
.
ÈÈ 
IsActive
ÈÈ !
!=
ÈÈ" $

userToEdit
ÈÈ% /
.
ÈÈ/ 0
IsActive
ÈÈ0 8
)
ÈÈ8 9

userToEdit
ÈÈ: D
.
ÈÈD E
IsActive
ÈÈE M
=
ÈÈN O
user
ÈÈP T
.
ÈÈT U
IsActive
ÈÈU ]
;
ÈÈ] ^
var
ÎÎ 
convertRoles
ÎÎ  
=
ÎÎ! "
new
ÎÎ# &
List
ÎÎ' +
<
ÎÎ+ ,
Role
ÎÎ, 0
>
ÎÎ0 1
(
ÎÎ1 2
)
ÎÎ2 3
;
ÎÎ3 4
if
ÏÏ 
(
ÏÏ 
roles
ÏÏ 
!=
ÏÏ 
null
ÏÏ !
)
ÏÏ! "
{
ÌÌ 
var
ÓÓ 
convert
ÓÓ 
=
ÓÓ  !
Mapper
ÓÓ" (
.
ÓÓ( )
Map
ÓÓ) ,
<
ÓÓ, -
IEnumerable
ÓÓ- 8
<
ÓÓ8 9
RoleDTO
ÓÓ9 @
>
ÓÓ@ A
,
ÓÓA B
IEnumerable
ÓÓC N
<
ÓÓN O
Role
ÓÓO S
>
ÓÓS T
>
ÓÓT U
(
ÓÓU V
roles
ÓÓV [
)
ÓÓ[ \
;
ÓÓ\ ]
foreach
ÔÔ 
(
ÔÔ 
var
ÔÔ  
item
ÔÔ! %
in
ÔÔ& (
convert
ÔÔ) 0
)
ÔÔ0 1
{
 
if
ÒÒ 
(
ÒÒ 
_roles
ÒÒ "
.
ÒÒ" #
FindById
ÒÒ# +
(
ÒÒ+ ,
item
ÒÒ, 0
.
ÒÒ0 1
RoleId
ÒÒ1 7
)
ÒÒ7 8
!=
ÒÒ9 ;
null
ÒÒ< @
)
ÒÒ@ A
{
ÚÚ 
convertRoles
ÛÛ (
.
ÛÛ( )
Add
ÛÛ) ,
(
ÛÛ, -
_roles
ÛÛ- 3
.
ÛÛ3 4
FindById
ÛÛ4 <
(
ÛÛ< =
item
ÛÛ= A
.
ÛÛA B
RoleId
ÛÛB H
)
ÛÛH I
)
ÛÛI J
;
ÛÛJ K
}
ÙÙ 
}
ıı 
}
ˆˆ 
if
¯¯ 
(
¯¯ 
roles
¯¯ 
.
¯¯ 
Any
¯¯ 
(
¯¯ 
)
¯¯ 
)
¯¯  

userToEdit
¯¯! +
.
¯¯+ ,
Roles
¯¯, 1
=
¯¯2 3
convertRoles
¯¯4 @
;
¯¯@ A
if
˘˘ 
(
˘˘ 
!
˘˘ 
roles
˘˘ 
.
˘˘ 
Any
˘˘ 
(
˘˘ 
)
˘˘  
)
˘˘  !

userToEdit
˘˘" ,
.
˘˘, -
Roles
˘˘- 2
=
˘˘3 4
null
˘˘5 9
;
˘˘9 :
var
˚˚ 
convertGroups
˚˚ !
=
˚˚" #
new
˚˚$ '
List
˚˚( ,
<
˚˚, -
Group
˚˚- 2
>
˚˚2 3
(
˚˚3 4
)
˚˚4 5
;
˚˚5 6
if
¸¸ 
(
¸¸ 
groups
¸¸ 
!=
¸¸ 
null
¸¸ "
)
¸¸" #
{
˝˝ 
var
˛˛ 
convert
˛˛ 
=
˛˛  !
Mapper
˛˛" (
.
˛˛( )
Map
˛˛) ,
<
˛˛, -
IEnumerable
˛˛- 8
<
˛˛8 9
GroupDTO
˛˛9 A
>
˛˛A B
,
˛˛B C
IEnumerable
˛˛D O
<
˛˛O P
Group
˛˛P U
>
˛˛U V
>
˛˛V W
(
˛˛W X
groups
˛˛X ^
)
˛˛^ _
;
˛˛_ `
foreach
ˇˇ 
(
ˇˇ 
var
ˇˇ  
item
ˇˇ! %
in
ˇˇ& (
convert
ˇˇ) 0
)
ˇˇ0 1
{
ÄÄ 
if
ÅÅ 
(
ÅÅ 
_groups
ÅÅ #
.
ÅÅ# $
FindById
ÅÅ$ ,
(
ÅÅ, -
item
ÅÅ- 1
.
ÅÅ1 2
GroupId
ÅÅ2 9
)
ÅÅ9 :
!=
ÅÅ; =
null
ÅÅ> B
)
ÅÅB C
{
ÇÇ 
convertGroups
ÉÉ )
.
ÉÉ) *
Add
ÉÉ* -
(
ÉÉ- .
_groups
ÉÉ. 5
.
ÉÉ5 6
FindById
ÉÉ6 >
(
ÉÉ> ?
item
ÉÉ? C
.
ÉÉC D
GroupId
ÉÉD K
)
ÉÉK L
)
ÉÉL M
;
ÉÉM N
}
ÑÑ 
}
ÖÖ 
}
ÜÜ 
if
àà 
(
àà 
groups
àà 
.
àà 
Any
àà 
(
àà 
)
àà  
)
àà  !

userToEdit
àà" ,
.
àà, -
Groups
àà- 3
=
àà4 5
convertGroups
àà6 C
;
ààC D
if
ââ 
(
ââ 
!
ââ 
groups
ââ 
.
ââ 
Any
ââ 
(
ââ  
)
ââ  !
)
ââ! "

userToEdit
ââ# -
.
ââ- .
Groups
ââ. 4
=
ââ5 6
null
ââ7 ;
;
ââ; <
_users
ää 
.
ää 
Update
ää 
(
ää 

userToEdit
ää (
)
ää( )
;
ää) *
_context
ãã 
.
ãã 
SaveChanges
ãã $
(
ãã$ %
)
ãã% &
;
ãã& '
}
åå 
}
çç 	
public
èè 
bool
èè 
	CheckUser
èè 
(
èè 
string
èè $
username
èè% -
)
èè- .
{
êê 	
if
ëë 
(
ëë 
username
ëë 
==
ëë 
null
ëë  
||
ëë! #
_users
ëë$ *
.
ëë* +
Get
ëë+ .
(
ëë. /
u
ëë/ 0
=>
ëë1 3
u
ëë4 5
.
ëë5 6
UserName
ëë6 >
.
ëë> ?
ToLower
ëë? F
(
ëëF G
)
ëëG H
.
ëëH I
Equals
ëëI O
(
ëëO P
username
ëëP X
.
ëëX Y
ToLower
ëëY `
(
ëë` a
)
ëëa b
)
ëëb c
)
ëëc d
.
ëëd e
Any
ëëe h
(
ëëh i
)
ëëi j
)
ëëj k
return
íí 
false
íí 
;
íí 
else
ìì 
return
ìì 
true
ìì 
;
ìì 
}
îî 	
public
ññ 
void
ññ 
DeactivateUser
ññ "
(
ññ" #
int
ññ# &
id
ññ' )
)
ññ) *
{
óó 	
User
òò 
user
òò 
=
òò 
_users
òò 
.
òò 
FindById
òò '
(
òò' (
id
òò( *
)
òò* +
;
òò+ ,
if
ôô 
(
ôô 
user
ôô 
.
ôô 
IsActive
ôô 
==
ôô  
true
ôô! %
)
ôô% &
user
öö 
.
öö 
IsActive
öö 
=
öö 
false
öö  %
;
öö% &
else
õõ 
user
õõ 
.
õõ 
IsActive
õõ 
=
õõ  
true
õõ! %
;
õõ% &
_context
úú 
.
úú 
SaveChanges
úú  
(
úú  !
)
úú! "
;
úú" #
}
ùù 	
public
üü 
UserDTO
üü 
GetUserById
üü "
(
üü" #
int
üü# &
id
üü' )
)
üü) *
{
†† 	
return
°° 
Mapper
°° 
.
°° 
Map
°° 
<
°° 
User
°° "
,
°°" #
UserDTO
°°$ +
>
°°+ ,
(
°°, -
_users
°°- 3
.
°°3 4
Get
°°4 7
(
°°7 8
u
°°8 9
=>
°°: <
u
°°= >
.
°°> ?
UserId
°°? E
==
°°F H
id
°°I K
)
°°K L
.
°°L M
FirstOrDefault
°°M [
(
°°[ \
)
°°\ ]
)
°°] ^
;
°°^ _
}
¢¢ 	
public
§§ 
ICollection
§§ 
<
§§ 
RoleDTO
§§ "
>
§§" #
GetUserRoles
§§$ 0
(
§§0 1
int
§§1 4
id
§§5 7
)
§§7 8
{
•• 	
return
¶¶ 
Mapper
¶¶ 
.
¶¶ 
Map
¶¶ 
<
¶¶ 
IEnumerable
¶¶ )
<
¶¶) *
Role
¶¶* .
>
¶¶. /
,
¶¶/ 0
ICollection
¶¶1 <
<
¶¶< =
RoleDTO
¶¶= D
>
¶¶D E
>
¶¶E F
(
¶¶F G
_users
¶¶G M
.
¶¶M N
FindById
¶¶N V
(
¶¶V W
id
¶¶W Y
)
¶¶Y Z
.
¶¶Z [
Roles
¶¶[ `
)
¶¶` a
;
¶¶a b
}
ßß 	
public
©© 
ICollection
©© 
<
©© 
GroupDTO
©© #
>
©©# $
GetUserGroups
©©% 2
(
©©2 3
int
©©3 6
id
©©7 9
)
©©9 :
{
™™ 	
return
´´ 
Mapper
´´ 
.
´´ 
Map
´´ 
<
´´ 
IEnumerable
´´ )
<
´´) *
Group
´´* /
>
´´/ 0
,
´´0 1
ICollection
´´2 =
<
´´= >
GroupDTO
´´> F
>
´´F G
>
´´G H
(
´´H I
_users
´´I O
.
´´O P
FindById
´´P X
(
´´X Y
id
´´Y [
)
´´[ \
.
´´\ ]
Groups
´´] c
)
´´c d
;
´´d e
}
¨¨ 	
public
∞∞ 
ICollection
∞∞ 
<
∞∞ 
UserDTO
∞∞ "
>
∞∞" #
GetUsers
∞∞$ ,
(
∞∞, -
)
∞∞- .
{
±± 	
List
≤≤ 
<
≤≤ 
User
≤≤ 
>
≤≤ 

collection
≤≤ !
;
≤≤! "
using
≥≥ 
(
≥≥ 
_logs
≥≥ 
.
≥≥ 
BeginTransaction
≥≥ )
(
≥≥) *
)
≥≥* +
)
≥≥+ ,
{
¥¥ 

collection
µµ 
=
µµ 
_users
µµ #
.
µµ# $
Get
µµ$ '
(
µµ' (
)
µµ( )
.
µµ) *
ToList
µµ* 0
(
µµ0 1
)
µµ1 2
;
µµ2 3
}
∂∂ 
var
∑∑ 
mappingCollection
∑∑ !
=
∑∑" #
Mapper
∑∑$ *
.
∑∑* +
Map
∑∑+ .
<
∑∑. /
IEnumerable
∑∑/ :
<
∑∑: ;
User
∑∑; ?
>
∑∑? @
,
∑∑@ A
ICollection
∑∑B M
<
∑∑M N
UserDTO
∑∑N U
>
∑∑U V
>
∑∑V W
(
∑∑W X

collection
∑∑X b
)
∑∑b c
.
∑∑c d
ToList
∑∑d j
(
∑∑j k
)
∑∑k l
;
∑∑l m
foreach
∏∏ 
(
∏∏ 
var
∏∏ 
item
∏∏ 
in
∏∏  
mappingCollection
∏∏! 2
)
∏∏2 3
{
ππ 
item
∫∫ 
.
∫∫ 
Groups
∫∫ 
=
∫∫ 
GetUserGroups
∫∫ +
(
∫∫+ ,
item
∫∫, 0
.
∫∫0 1
UserId
∫∫1 7
)
∫∫7 8
;
∫∫8 9
item
ªª 
.
ªª 
Roles
ªª 
=
ªª 
GetUserRoles
ªª )
(
ªª) *
item
ªª* .
.
ªª. /
UserId
ªª/ 5
)
ªª5 6
;
ªª6 7
}
ºº 
return
ΩΩ 
mappingCollection
ΩΩ $
;
ΩΩ$ %
}
ææ 	
public
¿¿ 
ICollection
¿¿ 
<
¿¿ 
GroupDTO
¿¿ #
>
¿¿# $
	GetGroups
¿¿% .
(
¿¿. /
)
¿¿/ 0
{
¡¡ 	
List
¬¬ 
<
¬¬ 
Group
¬¬ 
>
¬¬ 

collection
¬¬ "
;
¬¬" #
using
√√ 
(
√√ 
_logs
√√ 
.
√√ 
BeginTransaction
√√ )
(
√√) *
)
√√* +
)
√√+ ,
{
ƒƒ 

collection
≈≈ 
=
≈≈ 
_groups
≈≈ $
.
≈≈$ %
Get
≈≈% (
(
≈≈( )
)
≈≈) *
.
≈≈* +
ToList
≈≈+ 1
(
≈≈1 2
)
≈≈2 3
;
≈≈3 4
}
∆∆ 
var
«« 
mappingCollection
«« !
=
««" #
Mapper
««$ *
.
««* +
Map
««+ .
<
««. /
IEnumerable
««/ :
<
««: ;
Group
««; @
>
««@ A
,
««A B
ICollection
««C N
<
««N O
GroupDTO
««O W
>
««W X
>
««X Y
(
««Y Z

collection
««Z d
)
««d e
.
««e f
ToList
««f l
(
««l m
)
««m n
;
««n o
foreach
»» 
(
»» 
var
»» 
item
»» 
in
»»  
mappingCollection
»»! 2
)
»»2 3
{
…… 
item
   
.
   
CreatorName
    
=
  ! "
GetUserById
  # .
(
  . /
item
  / 3
.
  3 4
	CreatorId
  4 =
)
  = >
.
  > ?
Name
  ? C
;
  C D
item
ÀÀ 
.
ÀÀ 

ParentName
ÀÀ 
=
ÀÀ  !
GetGroupName
ÀÀ" .
(
ÀÀ. /
item
ÀÀ/ 3
.
ÀÀ3 4
ParentId
ÀÀ4 <
)
ÀÀ< =
;
ÀÀ= >
item
ÃÃ 
.
ÃÃ 
Groups
ÃÃ 
=
ÃÃ %
GetGroupFirstGeneration
ÃÃ 5
(
ÃÃ5 6
item
ÃÃ6 :
.
ÃÃ: ;
GroupId
ÃÃ; B
)
ÃÃB C
;
ÃÃC D
item
ÕÕ 
.
ÕÕ 
Users
ÕÕ 
=
ÕÕ 
GetGroupUsers
ÕÕ *
(
ÕÕ* +
item
ÕÕ+ /
.
ÕÕ/ 0
GroupId
ÕÕ0 7
)
ÕÕ7 8
;
ÕÕ8 9
}
ŒŒ 
return
œœ 
mappingCollection
œœ $
;
œœ$ %
}
–– 	
public
““ 
ICollection
““ 
<
““ 
RoleDTO
““ "
>
““" #
GetRoles
““$ ,
(
““, -
)
““- .
{
”” 	
return
‘‘ 
Mapper
‘‘ 
.
‘‘ 
Map
‘‘ 
<
‘‘ 
IEnumerable
‘‘ )
<
‘‘) *
Role
‘‘* .
>
‘‘. /
,
‘‘/ 0
ICollection
‘‘1 <
<
‘‘< =
RoleDTO
‘‘= D
>
‘‘D E
>
‘‘E F
(
‘‘F G
_roles
‘‘G M
.
‘‘M N
Get
‘‘N Q
(
‘‘Q R
)
‘‘R S
)
‘‘S T
;
‘‘T U
}
’’ 	
public
◊◊ 
ICollection
◊◊ 
<
◊◊ 
LogDTO
◊◊ !
>
◊◊! "
GetLogs
◊◊# *
(
◊◊* +
)
◊◊+ ,
{
ÿÿ 	
List
ŸŸ 
<
ŸŸ 
Log
ŸŸ 
>
ŸŸ 

collection
ŸŸ  
;
ŸŸ  !
using
⁄⁄ 
(
⁄⁄ 
_logs
⁄⁄ 
.
⁄⁄ 
BeginTransaction
⁄⁄ )
(
⁄⁄) *
)
⁄⁄* +
)
⁄⁄+ ,
{
€€ 

collection
‹‹ 
=
‹‹ 
_logs
‹‹ "
.
‹‹" #
Get
‹‹# &
(
‹‹& '
)
‹‹' (
.
‹‹( )
ToList
‹‹) /
(
‹‹/ 0
)
‹‹0 1
;
‹‹1 2
}
›› 
var
ﬁﬁ 
mappingCollection
ﬁﬁ !
=
ﬁﬁ" #
Mapper
ﬁﬁ$ *
.
ﬁﬁ* +
Map
ﬁﬁ+ .
<
ﬁﬁ. /
IEnumerable
ﬁﬁ/ :
<
ﬁﬁ: ;
Log
ﬁﬁ; >
>
ﬁﬁ> ?
,
ﬁﬁ? @
ICollection
ﬁﬁA L
<
ﬁﬁL M
LogDTO
ﬁﬁM S
>
ﬁﬁS T
>
ﬁﬁT U
(
ﬁﬁU V

collection
ﬁﬁV `
)
ﬁﬁ` a
.
ﬁﬁa b
ToList
ﬁﬁb h
(
ﬁﬁh i
)
ﬁﬁi j
;
ﬁﬁj k
foreach
ﬂﬂ 
(
ﬂﬂ 
var
ﬂﬂ 
item
ﬂﬂ 
in
ﬂﬂ  
mappingCollection
ﬂﬂ! 2
)
ﬂﬂ2 3
{
‡‡ 
item
·· 
.
·· 
ActionAuthorName
·· %
=
··& '
GetUserById
··( 3
(
··3 4
item
··4 8
.
··8 9
ActionAuthorId
··9 G
)
··G H
.
··H I
Name
··I M
;
··M N
item
‚‚ 
.
‚‚ 
CreatorName
‚‚  
=
‚‚! "
GetUserById
‚‚# .
(
‚‚. /
item
‚‚/ 3
.
‚‚3 4
	CreatorId
‚‚4 =
)
‚‚= >
.
‚‚> ?
Name
‚‚? C
;
‚‚C D
}
„„ 
return
‰‰ 
mappingCollection
‰‰ $
;
‰‰$ %
}
ÂÂ 	
public
ÁÁ 
int
ÁÁ 
GetNumberOfAdmins
ÁÁ $
(
ÁÁ$ %
)
ÁÁ% &
{
ËË 	
return
ÈÈ 
_users
ÈÈ 
.
ÈÈ 
Get
ÈÈ 
(
ÈÈ 
u
ÈÈ 
=>
ÈÈ  "
u
ÈÈ# $
.
ÈÈ$ %
IsActive
ÈÈ% -
&&
ÈÈ. 0
(
ÈÈ1 2
u
ÈÈ2 3
.
ÈÈ3 4
Roles
ÈÈ4 9
.
ÈÈ9 :
Where
ÈÈ: ?
(
ÈÈ? @
r
ÈÈ@ A
=>
ÈÈB D
r
ÈÈE F
.
ÈÈF G
Name
ÈÈG K
==
ÈÈL N
$str
ÈÈO V
)
ÈÈV W
)
ÈÈW X
.
ÈÈX Y
Any
ÈÈY \
(
ÈÈ\ ]
)
ÈÈ] ^
)
ÈÈ^ _
.
ÈÈ_ `
Count
ÈÈ` e
(
ÈÈe f
)
ÈÈf g
;
ÈÈg h
}
ÍÍ 	
}
ÎÎ 
}ÏÏ ˇ
_C:\Users\Dzianis_Tarasevich\Desktop\saves\16\WpfOutlook\BLL\BLLService\AuthenticationService.cs
	namespace

 	
BLL


 
.

 
Services

 
{ 
public 

class !
AuthenticationService &
:' ("
IAuthenticationService) ?
{ 
private 
IGenericRepository "
<" #
User# '
>' (
_users) /
;/ 0
public !
AuthenticationService $
($ %
IGenericRepository% 7
<7 8
User8 <
>< =
users> C
)C D
{ 	
_users 
= 
users 
; 
} 	
public 
UserDTO 
AuthenticateUser '
(' (
string( .
username/ 7
,7 8
string9 ?
password@ H
)H I
{ 	
User 
user 
= 
_users 
. 
Get !
(! "
u" #
=>$ &
u' (
.( )
UserName) 1
.1 2
Equals2 8
(8 9
username9 A
)A B
&&C E
uF G
.G H
PasswordH P
.P Q
EqualsQ W
(W X
EncryptionHelpersX i
.i j
HashPasswordj v
(v w
passwordw 
,	 Ä
u
Å Ç
.
Ç É
Salt
É á
)
á à
)
à â
)
â ä
.
ä ã
FirstOrDefault
ã ô
(
ô ö
)
ö õ
;
õ ú
if 
( 
user 
!= 
null 
&& 
user  $
.$ %
IsActive% -
)- .
{ 
using 
( 
var 
transaction &
=' (
_users) /
./ 0
BeginTransaction0 @
(@ A
)A B
)B C
{ 
user 
= 
_users !
.! "
FindById" *
(* +
user+ /
./ 0
UserId0 6
)6 7
;7 8
user 
. 
Salt 
= 
EncryptionHelpers  1
.1 2
GenerateSalt2 >
(> ?
)? @
;@ A
user 
. 
Password !
=" #
EncryptionHelpers$ 5
.5 6
HashPassword6 B
(B C
passwordC K
,K L
userM Q
.Q R
SaltR V
)V W
;W X
_users 
. 
Save 
(  
)  !
;! "
transaction   
.    
Commit    &
(  & '
)  ' (
;  ( )
}!! 
return"" 
Mapper"" 
."" 
Map"" !
<""! "
User""" &
,""& '
UserDTO""' .
>"". /
(""/ 0
user""0 4
)""4 5
;""5 6
}## 
else$$ 
throw$$ 
new$$ '
UnauthorizedAccessException$$ 6
($$6 7
$str$$7 K
)$$K L
;$$L M
}%% 	
public'' 
string'' 
['' 
]'' 
GetRoles''  
(''  !
int''! $
userId''% +
)''+ ,
{(( 	
return)) 
_users)) 
.)) 
FindById)) "
())" #
userId))# )
)))) *
.))* +
Roles))+ 0
.))0 1
Select))1 7
())7 8
r))8 9
=>)): <
r))= >
.))> ?
Name))? C
)))C D
.))D E
ToArray))E L
())L M
)))M N
;))N O
}** 	
},, 
}-- Á
TC:\Users\Dzianis_Tarasevich\Desktop\saves\16\WpfOutlook\BLL\BLLService\LogService.cs
	namespace 	
BLL
 
. 

BLLService 
{ 
public 

class 

LogService 
: 
ILogService )
{ 
private 
readonly 
IGenericRepository +
<+ ,
Log, /
>/ 0
_logs1 6
;6 7
public 

LogService 
( 
IGenericRepository ,
<, -
Log- 0
>0 1
logs2 6
)6 7
{ 	
_logs 
= 
logs 
; 
} 	
public 
void 
LogAppointment "
(" #
AppointmentDTO# 1
appointment2 =
,= >
int? B
idC E
,E F
boolG K
actionL R
)R S
{ 	
using 
( 
var 
transaction "
=# $
_logs% *
.* +
BeginTransaction+ ;
(; <
)< =
)= >
{ 
try 
{ 
_logs 
. 
Create  
(  !
new! $
Log% (
{ 
AppointmentName '
=( )
appointment* 5
.5 6
Subject6 =
,= >
ActionAuthorId   &
=  ' (
id  ) +
,  + ,
	CreatorId!! !
=!!" #
id!!$ &
,!!& '
Action"" 
=""  
action""! '
?""( )
$str""* 1
:""2 3
$str""4 =
,""> ?
	EventTime## !
=##" #
DateTime##$ ,
.##, -
Now##- 0
}$$ 
)$$ 
;$$ 
_logs%% 
.%% 
Save%% 
(%% 
)%%  
;%%  !
transaction&& 
.&&  
Commit&&  &
(&&& '
)&&' (
;&&( )
}'' 
catch(( 
((( 
	Exception((  
e((! "
)((" #
{)) 
transaction** 
.**  
Rollback**  (
(**( )
)**) *
;*** +
throw++ 
new++ 
	Exception++ '
(++' (
e++( )
+++* +
$str++, 7
)++7 8
;++8 9
},, 
}-- 
}.. 	
}11 
}22 ﬂS
WC:\Users\Dzianis_Tarasevich\Desktop\saves\16\WpfOutlook\BLL\BLLService\NotifyService.cs
	namespace 	
BLL
 
. 

BLLService 
{ 
public 

class 
NotifyService 
:  
INotifyService! /
{ 
private 
readonly 
IGenericRepository +
<+ ,
Notification, 8
>8 9
_notifications: H
;H I
private 
readonly 
IGenericRepository +
<+ ,
User, 0
>0 1
_users2 8
;8 9
private 
readonly 
IGenericRepository +
<+ ,
Location, 4
>4 5

_locations6 @
;@ A
public 
NotifyService 
( 
IGenericRepository /
</ 0
Notification0 <
>< =
notifications> K
,K L
IGenericRepositoryM _
<_ `
User` d
>d e
usersf k
,k l
IGenericRepositorym 
<	 Ä
Location
Ä à
>
à â
	locations
ä ì
)
ì î
{ 	
_notifications 
= 
notifications *
;* +
_users 
= 
users 
; 

_locations 
= 
	locations "
;" #
} 	
public 
IEnumerable 
< 
NotificationDTO *
>* +$
GetNotificationsByUserId, D
(D E
intE H
idI K
)K L
{ 	
List 
< 
Notification 
> 

collection )
;) *
using 
( 
_notifications !
.! "
BeginTransaction" 2
(2 3
)3 4
)4 5
{ 

collection   
=   
_notifications   +
.  + ,
Get  , /
(  / 0
x  0 1
=>  2 4
x  5 6
.  6 7
Users  7 <
.  < =
Any  = @
(  @ A
s  A B
=>  C E
s  F G
.  G H
UserId  H N
==  O Q
id  R T
)  T U
)  U V
.  V W
ToList  W ]
(  ] ^
)  ^ _
;  _ `
}!! 
var"" 
mappingCollection"" !
=""" #
Mapper""$ *
.""* +
Map""+ .
<"". /
IEnumerable""/ :
<"": ;
Notification""; G
>""G H
,""H I
IEnumerable""J U
<""U V
NotificationDTO""V e
>""e f
>""f g
(""g h

collection""h r
)""r s
.""s t
ToList""t z
(""z {
)""{ |
;""| }
foreach## 
(## 
var## 
item## 
in##  
mappingCollection##! 2
)##2 3
{$$ 
item%% 
.%% 
Room%% 
=%% 

_locations%% &
.%%& '
FindById%%' /
(%%/ 0
item%%0 4
.%%4 5

LocationId%%5 ?
)%%? @
.%%@ A
Room%%A E
;%%E F
}&& 
return'' 
mappingCollection'' $
;''$ %
}(( 	
public** 
void** 
AddNotification** #
(**# $
AppointmentDTO**$ 2
appointment**3 >
,**> ?
int**@ C
organizerId**D O
)**O P
{++ 	
var,, 
notificationItem,,  
=,,! "
Mapper,,# )
.,,) *
Map,,* -
<,,- .
AppointmentDTO,,. <
,,,< =
Notification,,> J
>,,J K
(,,K L
appointment,,L W
),,W X
;,,X Y
notificationItem-- 
.-- 
OrganizerId-- (
=--) *
organizerId--+ 6
;--6 7
notificationItem.. 
... 
	Organizer.. &
=..' (
_users..) /
.../ 0
FindById..0 8
(..8 9
organizerId..9 D
)..D E
;..E F
notificationItem// 
.// 
Users// "
=//# $
new//% (
List//) -
<//- .
User//. 2
>//2 3
(//3 4
)//4 5
;//5 6
var00 
convert00 
=00 
Mapper00  
.00  !
Map00! $
<00$ %
IEnumerable00% 0
<000 1
UserDTO001 8
>008 9
,009 :
IEnumerable00; F
<00F G
User00G K
>00K L
>00L M
(00M N
appointment00N Y
.00Y Z
Users00Z _
)00_ `
;00` a
foreach11 
(11 
var11 
item11 
in11  
convert11! (
)11( )
{22 
if33 
(33 
_users33 
.33 
FindById33 #
(33# $
item33$ (
.33( )
UserId33) /
)33/ 0
!=331 3
null334 8
)338 9
{44 
notificationItem55 $
.55$ %
Users55% *
.55* +
Add55+ .
(55. /
_users55/ 5
.555 6
FindById556 >
(55> ?
item55? C
.55C D
UserId55D J
)55J K
)55K L
;55L M
}66 
}77 
using99 
(99 
var99 
transaction99 "
=99# $
_notifications99% 3
.993 4
BeginTransaction994 D
(99D E
)99E F
)99F G
{:: 
try;; 
{<< 
_notifications== "
.==" #
Create==# )
(==) *
notificationItem==* :
)==: ;
;==; <
_notifications>> "
.>>" #
Save>># '
(>>' (
)>>( )
;>>) *
transaction?? 
.??  
Commit??  &
(??& '
)??' (
;??( )
}@@ 
catchAA 
(AA 
	ExceptionAA  
eAA! "
)AA" #
{BB 
transactionCC 
.CC  
RollbackCC  (
(CC( )
)CC) *
;CC* +

MessageBoxDD 
.DD 
ShowDD #
(DD# $
eDD$ %
+DD& '
$strDD( ?
)DD? @
;DD@ A
}EE 
}FF 
}GG 	
publicII 
voidII "
RemoveFromNotificationII *
(II* +
intII+ .
notifyIdII/ 7
,II7 8
intII9 <
userIdII= C
)IIC D
{JJ 	
varKK 
notificationKK 
=KK 
_notificationsKK -
.KK- .
FindByIdKK. 6
(KK6 7
notifyIdKK7 ?
)KK? @
;KK@ A
ifLL 
(LL 
notificationLL 
!=LL 
nullLL  $
)LL$ %
{MM 
usingNN 
(NN 
varNN 
transactionNN &
=NN' (
_notificationsNN) 7
.NN7 8
BeginTransactionNN8 H
(NNH I
)NNI J
)NNJ K
{OO 
tryPP 
{QQ 
notificationRR %
.RR% &
UsersRR& +
.RR+ ,
RemoveRR, 2
(RR2 3
_usersRR3 9
.RR9 :
FindByIdRR: B
(RRB C
userIdRRC I
)RRI J
)RRJ K
;RRK L
_notificationsSS &
.SS& '
SaveSS' +
(SS+ ,
)SS, -
;SS- .
transactionTT #
.TT# $
CommitTT$ *
(TT* +
)TT+ ,
;TT, -
}UU 
catchVV 
(VV 
	ExceptionVV $
eVV% &
)VV& '
{WW 
transactionXX #
.XX# $
RollbackXX$ ,
(XX, -
)XX- .
;XX. /
throwYY 
newYY !
	ExceptionYY" +
(YY+ ,
eYY, -
+YY. /
$strYY0 G
)YYG H
;YYH I
}ZZ 
}[[ 
}\\ 
}]] 	
public__ 
void__ 
RemoveNotification__ &
(__& '
int__' *
notifyId__+ 3
,__3 4
int__5 8
userId__9 ?
)__? @
{`` 	
varaa 
notificationaa 
=aa 
_notificationsaa -
.aa- .
FindByIdaa. 6
(aa6 7
notifyIdaa7 ?
)aa? @
;aa@ A
ifbb 
(bb 
notificationbb 
!=bb 
nullbb  $
)bb$ %
{cc 
usingdd 
(dd 
vardd 
transactiondd &
=dd' (
_notificationsdd) 7
.dd7 8
BeginTransactiondd8 H
(ddH I
)ddI J
)ddJ K
{ee 
tryff 
{gg 
ifhh 
(hh 
notificationhh (
.hh( )
OrganizerIdhh) 4
==hh5 7
userIdhh8 >
||hh? A
notificationhhB N
.hhN O
UsershhO T
.hhT U
CounthhU Z
==hh[ ]
$numhh^ _
&&hh` b
notificationhhc o
.hho p
Usershhp u
.hhu v
	ElementAthhv 
(	hh Ä
$num
hhÄ Å
)
hhÅ Ç
.
hhÇ É
UserId
hhÉ â
==
hhä å
userId
hhç ì
)
hhì î
{ii 
_notificationsjj *
.jj* +
Removejj+ 1
(jj1 2
notificationjj2 >
)jj> ?
;jj? @
}kk 
elsell 
{mm 
notificationnn (
.nn( )
Usersnn) .
.nn. /
Removenn/ 5
(nn5 6
_usersnn6 <
.nn< =
FindByIdnn= E
(nnE F
userIdnnF L
)nnL M
)nnM N
;nnN O
}oo 
_notificationspp &
.pp& '
Savepp' +
(pp+ ,
)pp, -
;pp- .
transactionqq #
.qq# $
Commitqq$ *
(qq* +
)qq+ ,
;qq, -
}rr 
catchss 
(ss 
	Exceptionss $
ess% &
)ss& '
{tt 
transactionuu #
.uu# $
Rollbackuu$ ,
(uu, -
)uu- .
;uu. /
throwvv 
newvv !
	Exceptionvv" +
(vv+ ,
evv, -
+vv. /
$strvv0 G
)vvG H
;vvH I
}ww 
}xx 
}yy 
}zz 	
}{{ 
}|| æ
XC:\Users\Dzianis_Tarasevich\Desktop\saves\16\WpfOutlook\BLL\EntitesDTO\AppointmentDTO.cs
	namespace 	
BLL
 
. 

EntitesDTO 
{ 
public 

class 
AppointmentDTO 
{ 
public 
int 
AppointmentId  
{! "
get# &
;& '
set( +
;+ ,
}- .
public		 
string		 
Subject		 
{		 
get		  #
;		# $
set		% (
;		( )
}		* +
public

 
DateTime

 
BeginningDate

 %
{

& '
get

( +
;

+ ,
set

- 0
;

0 1
}

2 3
public 
DateTime 

EndingDate "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 
int 
OrganizerId 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
int 

LocationId 
{ 
get  #
;# $
set% (
;( )
}* +
public 
string 
Room 
{ 
get  
;  !
set" %
;% &
}' (
public 
ICollection 
< 
UserDTO "
>" #
Users$ )
{* +
get, /
;/ 0
set1 4
;4 5
}6 7
} 
} Ó
RC:\Users\Dzianis_Tarasevich\Desktop\saves\16\WpfOutlook\BLL\EntitesDTO\GroupDTO.cs
	namespace 	
BLL
 
. 

EntitesDTO 
{ 
public		 

class		 
GroupDTO		 
{

 
public 
int 
GroupId 
{ 
get  
;  !
set" %
;% &
}' (
public 
string 
	GroupName 
{  !
get" %
;% &
set' *
;* +
}, -
public 
int 
? 
ParentId 
{ 
get "
;" #
set$ '
;' (
}) *
public 
int 
	CreatorId 
{ 
get "
;" #
set$ '
;' (
}) *
public 
string 
CreatorName !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
string 

ParentName  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
ICollection 
< 
GroupDTO #
># $
Groups% +
{, -
get. 1
;1 2
set3 6
;6 7
}8 9
public 
ICollection 
< 
UserDTO "
>" #
Users$ )
{* +
get, /
;/ 0
set1 4
;4 5
}6 7
} 
} ï
UC:\Users\Dzianis_Tarasevich\Desktop\saves\16\WpfOutlook\BLL\EntitesDTO\LocationDTO.cs
	namespace		 	
BLL		
 
.		 

EntitesDTO		 
{

 
public 

class 
LocationDTO 
: 
IDataErrorInfo -
,- ."
INotifyPropertyChanged/ E
{ 
public 
int 

LocationId 
{ 
get  #
;# $
set% (
;( )
}* +
public 
string 
Room 
{ 
get  
;  !
set" %
;% &
}' (
string 
IDataErrorInfo 
. 
Error #
{ 	
get 
{ 
return 
null 
; 
} 
} 	
string 
IDataErrorInfo 
. 
this "
[" #
string# )
propertyName* 6
]6 7
{ 	
get 
{ 
return 
GetValidationError +
(+ ,
propertyName, 8
)8 9
;9 :
}; <
} 	
static   
readonly   
string   
[   
]    
ValidatedProperties  ! 4
=  5 6
{!! 	
$str"" 
}## 	
;##	 

public%% 
bool%% 
IsValid%% 
{&& 	
get'' 
{(( 
foreach)) 
()) 
var)) 
property)) %
in))& (
ValidatedProperties))) <
)))< =
{** 
if++ 
(++ 
GetValidationError++ *
(++* +
property+++ 3
)++3 4
!=++5 7
null++8 <
)++< =
{,, 
return-- 
false-- $
;--$ %
}.. 
}// 
return00 
true00 
;00 
}11 
}22 	
string44 
GetValidationError44 !
(44! "
string44" (
propertyName44) 5
)445 6
{55 	
string66 
error66 
=66 
null66 
;66  
switch88 
(88 
propertyName88  
)88  !
{99 
case:: 
$str:: !
:::! "
error;; 
=;; 
ValidateLocationId;; .
(;;. /
);;/ 0
;;;0 1
break<< 
;<< 
}== 
return?? 
error?? 
;?? 
}@@ 	
privateBB 
stringBB 
ValidateLocationIdBB )
(BB) *
)BB* +
{CC 	
ifDD 
(DD 

LocationIdDD 
==DD 
$numDD 
||DD  "

LocationIdDD# -
<DD. /
$numDD0 1
)DD1 2
{EE 
returnFF 
$strFF )
;FF) *
}GG 
returnHH 
nullHH 
;HH 
}II 	
[MM 	
fieldMM	 
:MM 
NonSerializedMM 
]MM 
publicNN 
eventNN '
PropertyChangedEventHandlerNN 0
PropertyChangedNN1 @
;NN@ A
publicOO 
voidOO !
NotifyPropertyChangedOO )
(OO) *
StringOO* 0
propertyNameOO1 =
)OO= >
{PP 	
ifQQ 
(QQ 
PropertyChangedQQ 
!=QQ  "
nullQQ# '
)QQ' (
{RR 
PropertyChangedSS 
(SS  
thisSS  $
,SS$ %
newSS& )$
PropertyChangedEventArgsSS* B
(SSB C
propertyNameSSC O
)SSO P
)SSP Q
;SSQ R
}TT 
}UU 	
}WW 
}XX Ä
PC:\Users\Dzianis_Tarasevich\Desktop\saves\16\WpfOutlook\BLL\EntitesDTO\LogDTO.cs
	namespace 	
BLL
 
. 

EntitesDTO 
{ 
public		 

class		 
LogDTO		 
{

 
public 
int 
LogId 
{ 
get 
; 
set  #
;# $
}% &
public 
string 
Action 
{ 
get "
;" #
set$ '
;' (
}) *
public 
string 
AppointmentName %
{& '
get( +
;+ ,
set- 0
;0 1
}2 3
public 
int 
ActionAuthorId !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
int 
	CreatorId 
{ 
get "
;" #
set$ '
;' (
}) *
public 
DateTime 
	EventTime !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
string 
ActionAuthorName &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
public 
string 
CreatorName !
{" #
get$ '
;' (
set) ,
;, -
}. /
} 
} ÷
YC:\Users\Dzianis_Tarasevich\Desktop\saves\16\WpfOutlook\BLL\EntitesDTO\NotificationDTO.cs
	namespace 	
BLL
 
. 

EntitesDTO 
{ 
public 

class 
NotificationDTO  
{ 
public 
int 
NotificationId !
{" #
get$ '
;' (
set) ,
;, -
}. /
public		 
string		 
Subject		 
{		 
get		  #
;		# $
set		% (
;		( )
}		* +
public

 
DateTime

 
BeginningDate

 %
{

& '
get

( +
;

+ ,
set

- 0
;

0 1
}

2 3
public 
DateTime 

EndingDate "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 
int 
OrganizerId 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
int 

LocationId 
{ 
get  #
;# $
set% (
;( )
}* +
public 
string 
Room 
{ 
get  
;  !
set" %
;% &
}' (
public 
virtual 
ICollection "
<" #
UserDTO# *
>* +
Users, 1
{2 3
get4 7
;7 8
set9 <
;< =
}> ?
} 
} ˚
QC:\Users\Dzianis_Tarasevich\Desktop\saves\16\WpfOutlook\BLL\EntitesDTO\RoleDTO.cs
	namespace 	
BLL
 
. 

EntitesDTO 
{ 
[		 
Serializable		 
]		 
public

 

class

 
RoleDTO

 
{ 
public 
int 
RoleId 
{ 
get 
;  
set! $
;$ %
}& '
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
} 
} Ò
QC:\Users\Dzianis_Tarasevich\Desktop\saves\16\WpfOutlook\BLL\EntitesDTO\UserDTO.cs
	namespace 	
BLL
 
. 

EntitesDTO 
{ 
[		 
Serializable		 
]		 
public

 

class

 
UserDTO

 
{ 
public 
int 
UserId 
{ 
get 
;  
set! $
;$ %
}& '
public 
bool 
IsActive 
{ 
get "
;" #
set$ '
;' (
}) *
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
public 
string 
UserName 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 
Password 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
ICollection 
< 
GroupDTO #
># $
Groups% +
{, -
get. 1
;1 2
set3 6
;6 7
}8 9
public 
ICollection 
< 
RoleDTO "
>" #
Roles$ )
{* +
get, /
;/ 0
set1 4
;4 5
}6 7
} 
} Ò#
`C:\Users\Dzianis_Tarasevich\Desktop\saves\16\WpfOutlook\BLL\Interfaces\IAdministrationService.cs
	namespace 	
BLL
 
. 

Interfaces 
{		 
public

 

	interface

 "
IAdministrationService

 +
{ 
void 

CreateUser 
( 
UserDTO 
user  $
,$ %
ICollection& 1
<1 2
GroupDTO2 :
>: ;
groups< B
,B C
ICollectionD O
<O P
RoleDTOP W
>W X
rolesY ^
)^ _
;_ `
void 
EditUser 
( 
UserDTO 
user "
," #
ICollection$ /
</ 0
GroupDTO0 8
>8 9
groups: @
,@ A
ICollectionB M
<M N
RoleDTON U
>U V
rolesW \
)\ ]
;] ^
ICollection 
< 
RoleDTO 
> 
GetUserRoles )
() *
int* -
id. 0
)0 1
;1 2
ICollection 
< 
GroupDTO 
> 
GetUserGroups +
(+ ,
int, /
id0 2
)2 3
;3 4
int 
GetNumberOfAdmins 
( 
) 
;  
UserDTO 
GetUserById 
( 
int 
id  "
)" #
;# $
GroupDTO 
GetGroupById 
( 
int !
?! "
id# %
)% &
;& '
string 
GetGroupName 
( 
int 
?  
id! #
)# $
;$ %
ICollection 
< 
string 
> 
GetGroupAncestors -
(- .
string. 4
	groupName5 >
)> ?
;? @
ICollection 
< 
int 
> 
GetGroupChildren )
() *
int* -
id. 0
)0 1
;1 2
ICollection 
< 
LogDTO 
> 
GetLogs #
(# $
)$ %
;% &
bool 
	CheckUser 
( 
string 
username &
)& '
;' (
bool 

CheckGroup 
( 
string 
	groupName (
)( )
;) *
void 
DeactivateUser 
( 
int 
id  "
)" #
;# $
void 
CreateGroup 
( 
GroupDTO !
group" '
,' (
ICollection) 4
<4 5
GroupDTO5 =
>= >
Groups? E
,E F
ICollectionG R
<R S
UserDTOS Z
>Z [
users\ a
,a b
intc f
idg i
)i j
;j k
void 
	EditGroup 
( 
GroupDTO 
group  %
,% &
ICollection' 2
<2 3
GroupDTO3 ;
>; <
Groups= C
,C D
ICollectionE P
<P Q
UserDTOQ X
>X Y
usersZ _
)_ `
;` a
void 
DeleteGroup 
( 
int 
id 
)  
;  !
ICollection 
< 
GroupDTO 
> #
GetGroupFirstGeneration 5
(5 6
int6 9
id: <
)< =
;= >
ICollection 
< 
UserDTO 
> 
GetGroupUsers *
(* +
int+ .
id/ 1
)1 2
;2 3
ICollection 
< 
GroupDTO 
> $
GetGroupsWithNoAncestors 6
(6 7
)7 8
;8 9
ICollection   
<   
RoleDTO   
>   
GetRoles   %
(  % &
)  & '
;  ' (
ICollection!! 
<!! 
GroupDTO!! 
>!! 
	GetGroups!! '
(!!' (
)!!( )
;!!) *
ICollection"" 
<"" 
UserDTO"" 
>"" 
GetUsers"" %
(""% &
)""& '
;""' (
}## 
}$$ ì
`C:\Users\Dzianis_Tarasevich\Desktop\saves\16\WpfOutlook\BLL\Interfaces\IAuthenticationService.cs
	namespace 	
BLL
 
. 

Interfaces 
{		 
public

 

	interface

 "
IAuthenticationService

 +
{ 
UserDTO 
AuthenticateUser  
(  !
string! '
username( 0
,0 1
string2 8
password9 A
)A B
;B C
string 
[ 
] 
GetRoles 
( 
int 
userId $
)$ %
;% &
} 
} •À
XC:\Users\Dzianis_Tarasevich\Desktop\saves\16\WpfOutlook\BLL\BLLService\BLLServiceMain.cs
	namespace 	
BLL
 
. 

BLLService 
{ 
public 

class 
BLLServiceMain 
:  !
IBLLServiceMain" 1
{ 
private 
readonly 
WPFOutlookContext *
_context+ 3
;3 4
private 
readonly 
IGenericRepository +
<+ ,
Appointment, 7
>7 8
_appointments9 F
;F G
private 
readonly 
IGenericRepository +
<+ ,
User, 0
>0 1
_users2 8
;8 9
private 
readonly 
IGenericRepository +
<+ ,
Location, 4
>4 5

_locations6 @
;@ A
public 
BLLServiceMain 
( 
IGenericRepository 0
<0 1
Appointment1 <
>< =
appointments> J
,J K
IGenericRepositoryL ^
<^ _
User_ c
>c d
userse j
,j k
IGenericRepositoryl ~
<~ 
Location	 á
>
á à
	locations
â í
,
í ì
WPFOutlookContext
î •
context
¶ ≠
)
≠ Æ
{ 	
_appointments 
= 
appointments (
;( )
_users 
= 
users 
; 

_locations 
= 
	locations "
;" #
_context 
= 
context 
; 
} 	
public 
IEnumerable 
< 
AppointmentDTO )
>) *#
GetAppointmentsByUserId+ B
(B C
intC F
idG I
)I J
{   	
List!! 
<!! 
Appointment!! 
>!! 

collection!! (
;!!( )
using"" 
("" 
_appointments""  
.""  !
BeginTransaction""! 1
(""1 2
)""2 3
)""3 4
{## 

collection$$ 
=$$ 
_appointments$$ *
.$$* +
Get$$+ .
($$. /
x$$/ 0
=>$$1 3
x$$4 5
.$$5 6
Users$$6 ;
.$$; <
Any$$< ?
($$? @
s$$@ A
=>$$B D
s$$E F
.$$F G
UserId$$G M
==$$N P
id$$Q S
)$$S T
)$$T U
.$$U V
ToList$$V \
($$\ ]
)$$] ^
;$$^ _
}%% 
var&& 
mappingCollection&& !
=&&" #
Mapper&&$ *
.&&* +
Map&&+ .
<&&. /
IEnumerable&&/ :
<&&: ;
Appointment&&; F
>&&F G
,&&G H
IEnumerable&&I T
<&&T U
AppointmentDTO&&U c
>&&c d
>&&d e
(&&e f

collection&&f p
)&&p q
.&&q r
ToList&&r x
(&&x y
)&&y z
;&&z {
foreach'' 
('' 
var'' 
item'' 
in''  
mappingCollection''! 2
)''2 3
{(( 
using)) 
()) 

_locations)) !
.))! "
BeginTransaction))" 2
())2 3
)))3 4
)))4 5
{** 
item++ 
.++ 
Room++ 
=++ 

_locations++  *
.++* +
FindById+++ 3
(++3 4
item++4 8
.++8 9

LocationId++9 C
)++C D
.++D E
Room++E I
;++I J
},, 
}-- 
return.. 
mappingCollection.. $
;..$ %
}// 	
public11 
IEnumerable11 
<11 
AppointmentDTO11 )
>11) *&
GetAppointmentsForCalendar11+ E
(11E F
int11F I
id11J L
)11L M
{22 	
List33 
<33 
Appointment33 
>33 

collection33 (
;33( )
using44 
(44 
_appointments44  
.44  !
BeginTransaction44! 1
(441 2
)442 3
)443 4
{55 

collection66 
=66 
_appointments66 *
.66* +
Get66+ .
(66. /
x66/ 0
=>661 3
x664 5
.665 6
Users666 ;
.66; <
Any66< ?
(66? @
s66@ A
=>66B D
s66E F
.66F G
UserId66G M
==66N P
id66Q S
)66S T
)66T U
.66U V
ToList66V \
(66\ ]
)66] ^
;66^ _
}77 
var88 
mappingCollection88 !
=88" #
Mapper88$ *
.88* +
Map88+ .
<88. /
IEnumerable88/ :
<88: ;
Appointment88; F
>88F G
,88G H
IEnumerable88I T
<88T U
AppointmentDTO88U c
>88c d
>88d e
(88e f

collection88f p
)88p q
.88q r
ToList88r x
(88x y
)88y z
;88z {
List99 
<99 
AppointmentDTO99 
>99  
forCalendar99! ,
=99- .
new99/ 2
List993 7
<997 8
AppointmentDTO998 F
>99F G
(99G H
)99H I
;99I J
foreach:: 
(:: 
var:: 
item:: 
in::  
mappingCollection::! 2
)::2 3
{;; 
using<< 
(<< 

_locations<< !
.<<! "
BeginTransaction<<" 2
(<<2 3
)<<3 4
)<<4 5
{== 
item>> 
.>> 
Room>> 
=>> 

_locations>>  *
.>>* +
FindById>>+ 3
(>>3 4
item>>4 8
.>>8 9

LocationId>>9 C
)>>C D
.>>D E
Room>>E I
;>>I J
}?? 
if@@ 
(@@ 
item@@ 
.@@ 
BeginningDate@@ &
.@@& '
	DayOfYear@@' 0
<@@1 2
item@@3 7
.@@7 8

EndingDate@@8 B
.@@B C
	DayOfYear@@C L
)@@L M
{AA 
forBB 
(BB 
intBB 
iBB 
=BB  
$numBB! "
;BB" #
iBB$ %
<=BB& (
itemBB) -
.BB- .

EndingDateBB. 8
.BB8 9
	DayOfYearBB9 B
-BBC D
itemBBE I
.BBI J
BeginningDateBBJ W
.BBW X
	DayOfYearBBX a
;BBa b
iBBc d
++BBd f
)BBf g
{CC 
AppointmentDTODD &
partDD' +
=DD, -
newDD. 1
AppointmentDTODD2 @
{EE 
AppointmentIdFF )
=FF* +
itemFF, 0
.FF0 1
AppointmentIdFF1 >
,FF> ?

LocationIdGG &
=GG' (
itemGG) -
.GG- .

LocationIdGG. 8
,GG8 9
OrganizerIdHH '
=HH( )
itemHH* .
.HH. /
OrganizerIdHH/ :
,HH: ;
RoomII  
=II! "
itemII# '
.II' (
RoomII( ,
,II, -
SubjectJJ #
=JJ$ %
itemJJ& *
.JJ* +
SubjectJJ+ 2
,JJ2 3
UsersKK !
=KK" #
itemKK$ (
.KK( )
UsersKK) .
,KK. /
}LL 
;LL 
ifMM 
(MM 
iMM 
==MM  
$numMM! "
)MM" #
{NN 
partPP  
.PP  !
BeginningDatePP! .
=PP/ 0
itemPP1 5
.PP5 6
BeginningDatePP6 C
;PPC D
partQQ  
.QQ  !

EndingDateQQ! +
=QQ, -
itemQQ. 2
.QQ2 3
BeginningDateQQ3 @
.QQ@ A
DateQQA E
.QQE F
AddDaysQQF M
(QQM N
$numQQN O
)QQO P
.QQP Q

AddSecondsQQQ [
(QQ[ \
-QQ\ ]
$numQQ] ^
)QQ^ _
;QQ_ `
forCalendarRR '
.RR' (
AddRR( +
(RR+ ,
partRR, 0
)RR0 1
;RR1 2
}SS 
ifTT 
(TT 
iTT 
==TT  
itemTT! %
.TT% &

EndingDateTT& 0
.TT0 1
	DayOfYearTT1 :
-TT; <
itemTT= A
.TTA B
BeginningDateTTB O
.TTO P
	DayOfYearTTP Y
)TTY Z
{UU 
partWW  
.WW  !
BeginningDateWW! .
=WW/ 0
itemWW1 5
.WW5 6

EndingDateWW6 @
.WW@ A
DateWWA E
.WWE F

AddSecondsWWF P
(WWP Q
$numWWQ R
)WWR S
;WWS T
partXX  
.XX  !

EndingDateXX! +
=XX, -
itemXX. 2
.XX2 3

EndingDateXX3 =
;XX= >
forCalendarYY '
.YY' (
AddYY( +
(YY+ ,
partYY, 0
)YY0 1
;YY1 2
}ZZ 
else[[ 
{\\ 
part^^  
.^^  !
BeginningDate^^! .
=^^/ 0
item^^1 5
.^^5 6
BeginningDate^^6 C
.^^C D
Date^^D H
.^^H I
AddDays^^I P
(^^P Q
i^^Q R
)^^R S
;^^S T
part__  
.__  !

EndingDate__! +
=__, -
item__. 2
.__2 3
BeginningDate__3 @
.__@ A
Date__A E
.__E F
AddDays__F M
(__M N
i__N O
+__P Q
$num__R S
)__S T
.__T U

AddSeconds__U _
(___ `
-__` a
$num__a b
)__b c
;__c d
forCalendar`` '
.``' (
Add``( +
(``+ ,
part``, 0
)``0 1
;``1 2
}aa 
}bb 
}cc 
elsedd 
{ee 
forCalendarff 
.ff  
Addff  #
(ff# $
itemff$ (
)ff( )
;ff) *
}gg 
}hh 
returnii 
forCalendarii 
;ii 
}jj 	
publicll 
LocationDTOll 
GetLocationByIdll *
(ll* +
intll+ .
idll/ 1
)ll1 2
{mm 	
Locationnn 
locationnn 
;nn 
usingoo 
(oo 

_locationsoo 
.oo 
BeginTransactionoo .
(oo. /
)oo/ 0
)oo0 1
{pp 
locationqq 
=qq 

_locationsqq %
.qq% &
FindByIdqq& .
(qq. /
idqq/ 1
)qq1 2
;qq2 3
}rr 
varss 
mappingItemss 
=ss 
Mapperss $
.ss$ %
Mapss% (
<ss( )
Locationss) 1
,ss1 2
LocationDTOss3 >
>ss> ?
(ss? @
locationss@ H
)ssH I
;ssI J
returntt 
mappingItemtt 
;tt 
}uu 	
publicww 
IEnumerableww 
<ww 
LocationDTOww &
>ww& '
GetLocationsww( 4
(ww4 5
)ww5 6
{xx 	
varyy 
locationsMapperyy 
=yy  !
Mapperyy" (
.yy( )
Mapyy) ,
<yy, -
IEnumerableyy- 8
<yy8 9
Locationyy9 A
>yyA B
,yyB C
IEnumerableyyD O
<yyO P
LocationDTOyyP [
>yy[ \
>yy\ ]
(yy] ^

_locationsyy^ h
.yyh i
Getyyi l
(yyl m
)yym n
)yyn o
;yyo p
returnzz 
locationsMapperzz "
;zz" #
}{{ 	
public}} 
IEnumerable}} 
<}} 
AppointmentDTO}} )
>}}) *
GetAppsByLocation}}+ <
(}}< =
int}}= @
id}}A C
)}}C D
{~~ 	
List 
< 
Appointment 
> 

collection (
;( )
using
ÄÄ 
(
ÄÄ 
_appointments
ÄÄ  
.
ÄÄ  !
BeginTransaction
ÄÄ! 1
(
ÄÄ1 2
)
ÄÄ2 3
)
ÄÄ3 4
{
ÅÅ 

collection
ÇÇ 
=
ÇÇ 
_appointments
ÇÇ *
.
ÇÇ* +
Get
ÇÇ+ .
(
ÇÇ. /
x
ÇÇ/ 0
=>
ÇÇ1 3
x
ÇÇ4 5
.
ÇÇ5 6

LocationId
ÇÇ6 @
==
ÇÇA C
id
ÇÇD F
)
ÇÇF G
.
ÇÇG H
ToList
ÇÇH N
(
ÇÇN O
)
ÇÇO P
;
ÇÇP Q
}
ÉÉ 
var
ÑÑ 
mappingCollection
ÑÑ !
=
ÑÑ" #
Mapper
ÑÑ$ *
.
ÑÑ* +
Map
ÑÑ+ .
<
ÑÑ. /
IEnumerable
ÑÑ/ :
<
ÑÑ: ;
Appointment
ÑÑ; F
>
ÑÑF G
,
ÑÑG H
IEnumerable
ÑÑI T
<
ÑÑT U
AppointmentDTO
ÑÑU c
>
ÑÑc d
>
ÑÑd e
(
ÑÑe f

collection
ÑÑf p
)
ÑÑp q
.
ÑÑq r
ToList
ÑÑr x
(
ÑÑx y
)
ÑÑy z
;
ÑÑz {
foreach
ÖÖ 
(
ÖÖ 
var
ÖÖ 
item
ÖÖ 
in
ÖÖ  
mappingCollection
ÖÖ! 2
)
ÖÖ2 3
{
ÜÜ 
using
áá 
(
áá 

_locations
áá !
.
áá! "
BeginTransaction
áá" 2
(
áá2 3
)
áá3 4
)
áá4 5
{
àà 
item
ââ 
.
ââ 
Room
ââ 
=
ââ 

_locations
ââ  *
.
ââ* +
FindById
ââ+ 3
(
ââ3 4
item
ââ4 8
.
ââ8 9

LocationId
ââ9 C
)
ââC D
.
ââD E
Room
ââE I
;
ââI J
}
ää 
}
ãã 
return
åå 
mappingCollection
åå $
;
åå$ %
}
çç 	
public
èè 
IEnumerable
èè 
<
èè 
UserDTO
èè "
>
èè" #
GetUsers
èè$ ,
(
èè, -
)
èè- .
{
êê 	
return
ëë 
Mapper
ëë 
.
ëë 
Map
ëë 
<
ëë 
IEnumerable
ëë )
<
ëë) *
User
ëë* .
>
ëë. /
,
ëë/ 0
IEnumerable
ëë1 <
<
ëë< =
UserDTO
ëë= D
>
ëëD E
>
ëëE F
(
ëëF G
_users
ëëG M
.
ëëM N
Get
ëëN Q
(
ëëQ R
)
ëëR S
)
ëëS T
;
ëëT U
}
íí 	
public
îî 
IEnumerable
îî 
<
îî 
UserDTO
îî "
>
îî" #!
GetAppointmentUsers
îî$ 7
(
îî7 8
int
îî8 ;
id
îî< >
)
îî> ?
{
ïï 	
return
ññ 
Mapper
ññ 
.
ññ 
Map
ññ 
<
ññ 
IEnumerable
ññ )
<
ññ) *
User
ññ* .
>
ññ. /
,
ññ/ 0
IEnumerable
ññ1 <
<
ññ< =
UserDTO
ññ= D
>
ññD E
>
ññE F
(
ññF G
_appointments
ññG T
.
ññT U
FindById
ññU ]
(
ññ] ^
id
ññ^ `
)
ññ` a
.
ñña b
Users
ññb g
.
ññg h
ToList
ññh n
(
ññn o
)
ñño p
)
ññp q
;
ññq r
}
óó 	
public
ôô 
void
ôô 
AddAppointment
ôô "
(
ôô" #
AppointmentDTO
ôô# 1
appointment
ôô2 =
,
ôô= >
int
ôô? B
id
ôôC E
)
ôôE F
{
öö 	
var
õõ 
appointmentItem
õõ 
=
õõ  !
Mapper
õõ" (
.
õõ( )
Map
õõ) ,
<
õõ, -
AppointmentDTO
õõ- ;
,
õõ; <
Appointment
õõ= H
>
õõH I
(
õõI J
appointment
õõJ U
)
õõU V
;
õõV W
appointmentItem
úú 
.
úú 
OrganizerId
úú '
=
úú( )
id
úú* ,
;
úú, -
appointmentItem
ùù 
.
ùù 
	Organizer
ùù %
=
ùù& '
_users
ùù( .
.
ùù. /
FindById
ùù/ 7
(
ùù7 8
id
ùù8 :
)
ùù: ;
;
ùù; <
appointmentItem
ûû 
.
ûû 
Location
ûû $
=
ûû% &

_locations
ûû' 1
.
ûû1 2
FindById
ûû2 :
(
ûû: ;
appointmentItem
ûû; J
.
ûûJ K

LocationId
ûûK U
)
ûûU V
;
ûûV W
appointmentItem
üü 
.
üü 
Users
üü !
=
üü" #
new
üü$ '
List
üü( ,
<
üü, -
User
üü- 1
>
üü1 2
(
üü2 3
)
üü3 4
;
üü4 5
var
†† 
convert
†† 
=
†† 
Mapper
††  
.
††  !
Map
††! $
<
††$ %
IEnumerable
††% 0
<
††0 1
UserDTO
††1 8
>
††8 9
,
††9 :
IEnumerable
††; F
<
††F G
User
††G K
>
††K L
>
††L M
(
††M N
appointment
††N Y
.
††Y Z
Users
††Z _
)
††_ `
;
††` a
foreach
°° 
(
°° 
var
°° 
item
°° 
in
°°  
convert
°°! (
)
°°( )
{
¢¢ 
if
££ 
(
££ 
_users
££ 
.
££ 
FindById
££ #
(
££# $
item
££$ (
.
££( )
UserId
££) /
)
££/ 0
!=
££1 3
null
££4 8
)
££8 9
{
§§ 
appointmentItem
•• #
.
••# $
Users
••$ )
.
••) *
Add
••* -
(
••- .
_users
••. 4
.
••4 5
FindById
••5 =
(
••= >
item
••> B
.
••B C
UserId
••C I
)
••I J
)
••J K
;
••K L
}
¶¶ 
}
ßß 
using
©© 
(
©© 
var
©© 
transaction
©© "
=
©©# $
_appointments
©©% 2
.
©©2 3
BeginTransaction
©©3 C
(
©©C D
)
©©D E
)
©©E F
{
™™ 
try
´´ 
{
¨¨ 
_appointments
≠≠ !
.
≠≠! "
Create
≠≠" (
(
≠≠( )
appointmentItem
≠≠) 8
)
≠≠8 9
;
≠≠9 :
_appointments
ÆÆ !
.
ÆÆ! "
Save
ÆÆ" &
(
ÆÆ& '
)
ÆÆ' (
;
ÆÆ( )
transaction
ØØ 
.
ØØ  
Commit
ØØ  &
(
ØØ& '
)
ØØ' (
;
ØØ( )
}
∞∞ 
catch
±± 
(
±± 
	Exception
±±  
e
±±! "
)
±±" #
{
≤≤ 
transaction
≥≥ 
.
≥≥  
Rollback
≥≥  (
(
≥≥( )
)
≥≥) *
;
≥≥* +

MessageBox
¥¥ 
.
¥¥ 
Show
¥¥ #
(
¥¥# $
e
¥¥$ %
+
¥¥& '
$str
¥¥( <
)
¥¥< =
;
¥¥= >
}
µµ 
}
∂∂ 
}
∑∑ 	
public
ππ 
void
ππ #
RemoveFromAppointment
ππ )
(
ππ) *
int
ππ* -
appointmentId
ππ. ;
,
ππ; <
int
ππ= @
userId
ππA G
)
ππG H
{
∫∫ 	
var
ªª 
appointment
ªª 
=
ªª 
_appointments
ªª +
.
ªª+ ,
FindById
ªª, 4
(
ªª4 5
appointmentId
ªª5 B
)
ªªB C
;
ªªC D
using
ºº 
(
ºº 
var
ºº 
transaction
ºº "
=
ºº# $
_appointments
ºº% 2
.
ºº2 3
BeginTransaction
ºº3 C
(
ººC D
)
ººD E
)
ººE F
{
ΩΩ 
try
ææ 
{
øø 
if
¿¿ 
(
¿¿ 
appointment
¿¿ #
.
¿¿# $
OrganizerId
¿¿$ /
==
¿¿0 2
userId
¿¿3 9
||
¿¿: <
appointment
¿¿= H
.
¿¿H I
Users
¿¿I N
.
¿¿N O
Count
¿¿O T
==
¿¿U W
$num
¿¿X Y
&&
¿¿Z \
appointment
¿¿] h
.
¿¿h i
Users
¿¿i n
.
¿¿n o
	ElementAt
¿¿o x
(
¿¿x y
$num
¿¿y z
)
¿¿z {
.
¿¿{ |
UserId¿¿| Ç
==¿¿É Ö
userId¿¿Ü å
)¿¿å ç
{
¡¡ 
_appointments
¬¬ %
.
¬¬% &
Remove
¬¬& ,
(
¬¬, -
appointment
¬¬- 8
)
¬¬8 9
;
¬¬9 :
}
√√ 
else
ƒƒ 
{
≈≈ 
appointment
∆∆ #
.
∆∆# $
Users
∆∆$ )
.
∆∆) *
Remove
∆∆* 0
(
∆∆0 1
_users
∆∆1 7
.
∆∆7 8
FindById
∆∆8 @
(
∆∆@ A
userId
∆∆A G
)
∆∆G H
)
∆∆H I
;
∆∆I J
}
«« 
_appointments
»» !
.
»»! "
Save
»»" &
(
»»& '
)
»»' (
;
»»( )
transaction
…… 
.
……  
Commit
……  &
(
……& '
)
……' (
;
……( )
}
   
catch
ÀÀ 
(
ÀÀ 
	Exception
ÀÀ  
e
ÀÀ! "
)
ÀÀ" #
{
ÃÃ 
transaction
ÕÕ 
.
ÕÕ  
Rollback
ÕÕ  (
(
ÕÕ( )
)
ÕÕ) *
;
ÕÕ* +
throw
ŒŒ 
new
ŒŒ 
	Exception
ŒŒ '
(
ŒŒ' (
e
ŒŒ( )
+
ŒŒ* +
$str
ŒŒ, 7
)
ŒŒ7 8
;
ŒŒ8 9
}
œœ 
}
–– 
}
—— 	
public
”” 
int
”” 
OverlappingDates
”” #
(
””# $
DateTime
””$ ,
beginningDate
””- :
,
””: ;
DateTime
””< D

endingDate
””E O
,
””O P
int
””Q T

locationId
””U _
)
””_ `
{
‘‘ 	
var
’’ 
param1
’’ 
=
’’ 
new
’’ 
SqlParameter
’’ )
(
’’) *
$str
’’* :
,
’’: ;
beginningDate
’’< I
)
’’I J
;
’’J K
var
÷÷ 
param2
÷÷ 
=
÷÷ 
new
÷÷ 
SqlParameter
÷÷ )
(
÷÷) *
$str
÷÷* 7
,
÷÷7 8

endingDate
÷÷9 C
)
÷÷C D
;
÷÷D E
var
◊◊ 
param3
◊◊ 
=
◊◊ 
new
◊◊ 
SqlParameter
◊◊ )
(
◊◊) *
$str
◊◊* 7
,
◊◊7 8

locationId
◊◊9 C
)
◊◊C D
;
◊◊D E
var
ÿÿ 

returnCode
ÿÿ 
=
ÿÿ 
new
ÿÿ  
SqlParameter
ÿÿ! -
{
ŸŸ 
ParameterName
⁄⁄ 
=
⁄⁄ 
$str
⁄⁄  -
,
⁄⁄- .
	SqlDbType
€€ 
=
€€ 
	SqlDbType
€€ %
.
€€% &
Int
€€& )
,
€€) *
	Direction
‹‹ 
=
‹‹  
ParameterDirection
‹‹ .
.
‹‹. /
Output
‹‹/ 5
}
›› 
;
›› 
using
ﬂﬂ 
(
ﬂﬂ 
new
ﬂﬂ 
WPFOutlookContext
ﬂﬂ (
(
ﬂﬂ( )
)
ﬂﬂ) *
)
ﬂﬂ* +
{
‡‡ 
_context
·· 
.
·· 
Database
·· !
.
··! "
ExecuteSqlCommand
··" 3
(
··3 4
$str··4 É
,··É Ñ
param1··Ö ã
,··ã å
param2··ç ì
,··ì î
param3··ï õ
,··õ ú

returnCode··ù ß
)··ß ®
;··® ©
var
‚‚ 
returnCodeValue
‚‚ #
=
‚‚$ %
(
‚‚& '
int
‚‚' *
)
‚‚* +

returnCode
‚‚+ 5
.
‚‚5 6
Value
‚‚6 ;
;
‚‚; <
return
„„ 
returnCodeValue
„„ &
;
„„& '
}
‰‰ 
}
ÂÂ 	
public
ÁÁ 
int
ÁÁ #
CheckOverlappingDates
ÁÁ (
(
ÁÁ( )
DateTime
ÁÁ) 1
beginningDate
ÁÁ2 ?
,
ÁÁ? @
DateTime
ÁÁA I

endingDate
ÁÁJ T
,
ÁÁT U
int
ÁÁV Y

locationId
ÁÁZ d
)
ÁÁd e
{
ËË 	
var
ÈÈ 
param1
ÈÈ 
=
ÈÈ 
new
ÈÈ 
SqlParameter
ÈÈ )
(
ÈÈ) *
$str
ÈÈ* :
,
ÈÈ: ;
beginningDate
ÈÈ< I
)
ÈÈI J
;
ÈÈJ K
var
ÍÍ 
param2
ÍÍ 
=
ÍÍ 
new
ÍÍ 
SqlParameter
ÍÍ )
(
ÍÍ) *
$str
ÍÍ* 7
,
ÍÍ7 8

endingDate
ÍÍ9 C
)
ÍÍC D
;
ÍÍD E
var
ÎÎ 
param3
ÎÎ 
=
ÎÎ 
new
ÎÎ 
SqlParameter
ÎÎ )
(
ÎÎ) *
$str
ÎÎ* 7
,
ÎÎ7 8

locationId
ÎÎ9 C
)
ÎÎC D
;
ÎÎD E
List
ÌÌ 
<
ÌÌ 
Appointment
ÌÌ 
>
ÌÌ 
result
ÌÌ $
;
ÌÌ$ %
using
ÓÓ 
(
ÓÓ 
new
ÓÓ 
WPFOutlookContext
ÓÓ (
(
ÓÓ( )
)
ÓÓ) *
)
ÓÓ* +
{
ÔÔ 
result
 
=
 
_context
 !
.
! "
Database
" *
.
* +
SqlQuery
+ 3
<
3 4
Appointment
4 ?
>
? @
(
@ A
$str
A u
,
u v
param1
w }
,
} ~
param2 Ö
,Ö Ü
param3á ç
)ç é
.é è
ToListè ï
(ï ñ
)ñ ó
;ó ò
}
ÒÒ 
return
ÛÛ 
result
ÛÛ 
.
ÛÛ 
Count
ÛÛ 
;
ÛÛ  
}
ÙÙ 	
}
ıı 
}ˆˆ Á
YC:\Users\Dzianis_Tarasevich\Desktop\saves\16\WpfOutlook\BLL\Interfaces\IBLLServiceMain.cs
	namespace 	
BLL
 
. 

Interfaces 
{ 
public 

	interface 
IBLLServiceMain $
{ 
IEnumerable		 
<		 
AppointmentDTO		 "
>		" ##
GetAppointmentsByUserId		$ ;
(		; <
int		< ?
id		@ B
)		B C
;		C D
IEnumerable

 
<

 
AppointmentDTO

 "
>

" #&
GetAppointmentsForCalendar

$ >
(

> ?
int

? B
id

C E
)

E F
;

F G
IEnumerable 
< 
LocationDTO 
>  
GetLocations! -
(- .
). /
;/ 0
IEnumerable 
< 
UserDTO 
> 
GetUsers %
(% &
)& '
;' (
IEnumerable 
< 
AppointmentDTO "
>" #
GetAppsByLocation$ 5
(5 6
int6 9
id: <
)< =
;= >
IEnumerable 
< 
UserDTO 
> 
GetAppointmentUsers 0
(0 1
int1 4
id5 7
)7 8
;8 9
LocationDTO 
GetLocationById #
(# $
int$ '
id( *
)* +
;+ ,
void 
AddAppointment 
( 
AppointmentDTO *
appointment+ 6
,6 7
int8 ;
id< >
)> ?
;? @
void !
RemoveFromAppointment "
(" #
int# &
appointmentId' 4
,4 5
int6 9
userId: @
)@ A
;A B
int 
OverlappingDates 
( 
DateTime %
beginningDate& 3
,3 4
DateTime5 =

endingDate> H
,H I
intJ M

locationIdN X
)X Y
;Y Z
int !
CheckOverlappingDates !
(! "
DateTime" *
beginningDate+ 8
,8 9
DateTime: B

endingDateC M
,M N
intO R

locationIdS ]
)] ^
;^ _
} 
} ï
UC:\Users\Dzianis_Tarasevich\Desktop\saves\16\WpfOutlook\BLL\Interfaces\ILogService.cs
	namespace 	
BLL
 
. 

Interfaces 
{		 
public

 

	interface

 
ILogService

  
{ 
void 
LogAppointment 
( 
AppointmentDTO *
appointment+ 6
,6 7
int8 ;
id< >
,> ?
bool@ D
actionE K
)K L
;L M
} 
} ∞
XC:\Users\Dzianis_Tarasevich\Desktop\saves\16\WpfOutlook\BLL\Interfaces\INotifyService.cs
	namespace 	
BLL
 
. 

Interfaces 
{		 
public

 

	interface

 
INotifyService

 #
{ 
IEnumerable 
< 
NotificationDTO #
># $$
GetNotificationsByUserId% =
(= >
int> A
idB D
)D E
;E F
void 
AddNotification 
( 
AppointmentDTO +
appointment, 7
,7 8
int9 <
organizerId= H
)H I
;I J
void "
RemoveFromNotification #
(# $
int$ '
notifyId( 0
,0 1
int2 5
userId6 <
)< =
;= >
void 
RemoveNotification 
(  
int  #
notifyId$ ,
,, -
int. 1
userId2 8
)8 9
;9 :
} 
} ù
VC:\Users\Dzianis_Tarasevich\Desktop\saves\16\WpfOutlook\BLL\Properties\AssemblyInfo.cs
[

 
assembly

 	
:

	 

AssemblyTitle

 
(

 
$str

 
)

 
]

  
[ 
assembly 	
:	 

AssemblyDescription 
( 
$str !
)! "
]" #
[ 
assembly 	
:	 
!
AssemblyConfiguration  
(  !
$str! #
)# $
]$ %
[ 
assembly 	
:	 

AssemblyCompany 
( 
$str )
)) *
]* +
[ 
assembly 	
:	 

AssemblyProduct 
( 
$str  
)  !
]! "
[ 
assembly 	
:	 

AssemblyCopyright 
( 
$str <
)< =
]= >
[ 
assembly 	
:	 

AssemblyTrademark 
( 
$str 
)  
]  !
[ 
assembly 	
:	 

AssemblyCulture 
( 
$str 
) 
] 
[ 
assembly 	
:	 


ComVisible 
( 
false 
) 
] 
["" 
assembly"" 	
:""	 

	ThemeInfo"" 
("" &
ResourceDictionaryLocation## 
.## 
None## #
,### $&
ResourceDictionaryLocation&& 
.&& 
SourceAssembly&& -
))) 
])) 
[66 
assembly66 	
:66	 

AssemblyVersion66 
(66 
$str66 $
)66$ %
]66% &
[77 
assembly77 	
:77	 

AssemblyFileVersion77 
(77 
$str77 (
)77( )
]77) *